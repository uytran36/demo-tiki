{"ast":null,"code":"import { __assign, __rest } from \"tslib\";\nimport { registerNode, BaseGlobal as Global } from '@antv/g6-core';\nimport { mix } from '@antv/util'; // 三角形\n\nregisterNode('triangle', {\n  // 自定义节点时的配置\n  options: {\n    size: 40,\n    direction: 'up',\n    style: {\n      stroke: Global.defaultNode.style.stroke,\n      fill: Global.defaultNode.style.fill,\n      lineWidth: Global.defaultNode.style.lineWidth\n    },\n    labelCfg: {\n      style: {\n        fill: Global.nodeLabel.style.fill,\n        fontSize: Global.nodeLabel.style.fontSize\n      },\n      offset: 15\n    },\n    // 节点上左右上下四个方向上的链接circle配置\n    linkPoints: {\n      top: false,\n      right: false,\n      bottom: false,\n      left: false,\n      // circle的大小\n      size: Global.defaultNode.linkPoints.size,\n      lineWidth: Global.defaultNode.linkPoints.lineWidth,\n      fill: Global.defaultNode.linkPoints.fill,\n      stroke: Global.defaultNode.linkPoints.stroke\n    },\n    // 节点中icon配置\n    icon: {\n      // 是否显示icon，值为 false 则不渲染icon\n      show: false,\n      // icon的地址，字符串类型\n      img: 'https://gw.alipayobjects.com/zos/bmw-prod/5d015065-8505-4e7a-baec-976f81e3c41d.svg',\n      width: 20,\n      height: 20,\n      offset: 6\n    },\n    stateStyles: __assign({}, Global.nodeStateStyles)\n  },\n  shapeType: 'triangle',\n  // 文本位置\n  labelPosition: 'bottom',\n  drawShape: function drawShape(cfg, group) {\n    var _a = this.getOptions(cfg),\n        _b = _a.icon,\n        icon = _b === void 0 ? {} : _b,\n        defaultDirection = _a.direction;\n\n    var style = this.getShapeStyle(cfg);\n    var direction = cfg.direction || defaultDirection;\n    var keyShape = group.addShape('path', {\n      attrs: style,\n      className: this.type + \"-keyShape\",\n      name: this.type + \"-keyShape\",\n      draggable: true\n    });\n    var w = icon.width,\n        h = icon.height,\n        show = icon.show,\n        offset = icon.offset,\n        text = icon.text;\n\n    if (show) {\n      if (text) {\n        group.addShape('text', {\n          attrs: __assign({\n            x: 0,\n            y: 0,\n            fontSize: 12,\n            fill: '#000',\n            stroke: '#000',\n            textBaseline: 'middle',\n            textAlign: 'center'\n          }, icon),\n          className: this.type + \"-icon\",\n          name: this.type + \"-icon\",\n          draggable: true\n        });\n      } else {\n        var iconW = -w / 2;\n        var iconH = -h / 2;\n\n        if (direction === 'up' || direction === 'down') {\n          iconH += offset;\n        }\n\n        if (direction === 'left' || direction === 'right') {\n          iconW += offset;\n        }\n\n        group.addShape('image', {\n          attrs: __assign({\n            x: iconW,\n            y: iconH\n          }, icon),\n          className: this.type + \"-icon\",\n          name: this.type + \"-icon\",\n          draggable: true\n        });\n      }\n    }\n\n    this.drawLinkPoints(cfg, group);\n    return keyShape;\n  },\n\n  /**\r\n   * 绘制节点上的LinkPoints\r\n   * @param {Object} cfg data数据配置项\r\n   * @param {Group} group Group实例\r\n   */\n  drawLinkPoints: function drawLinkPoints(cfg, group) {\n    var _a = this.getOptions(cfg),\n        _b = _a.linkPoints,\n        linkPoints = _b === void 0 ? {} : _b,\n        defaultDirection = _a.direction;\n\n    var direction = cfg.direction || defaultDirection;\n\n    var top = linkPoints.top,\n        left = linkPoints.left,\n        right = linkPoints.right,\n        bottom = linkPoints.bottom,\n        markSize = linkPoints.size,\n        markR = linkPoints.r,\n        markStyle = __rest(linkPoints, [\"top\", \"left\", \"right\", \"bottom\", \"size\", \"r\"]);\n\n    var size = this.getSize(cfg);\n    var len = size[0];\n\n    if (left) {\n      // up down left right 四个方向的坐标均不相同\n      var leftPos = null;\n      var diffY = len * Math.sin(1 / 3 * Math.PI);\n      var r = len * Math.sin(1 / 3 * Math.PI);\n\n      if (direction === 'up') {\n        leftPos = [-r, diffY];\n      } else if (direction === 'down') {\n        leftPos = [-r, -diffY];\n      } else if (direction === 'left') {\n        leftPos = [-r, r - diffY];\n      }\n\n      if (leftPos) {\n        // left circle\n        group.addShape('circle', {\n          attrs: __assign(__assign({}, markStyle), {\n            x: leftPos[0],\n            y: leftPos[1],\n            r: markSize / 2 || markR || 5\n          }),\n          className: 'link-point-left',\n          name: 'link-point-left'\n        });\n      }\n    }\n\n    if (right) {\n      // right circle\n      // up down left right 四个方向的坐标均不相同\n      var rightPos = null;\n      var diffY = len * Math.sin(1 / 3 * Math.PI);\n      var r = len * Math.sin(1 / 3 * Math.PI);\n\n      if (direction === 'up') {\n        rightPos = [r, diffY];\n      } else if (direction === 'down') {\n        rightPos = [r, -diffY];\n      } else if (direction === 'right') {\n        rightPos = [r, r - diffY];\n      }\n\n      if (rightPos) {\n        group.addShape('circle', {\n          attrs: __assign(__assign({}, markStyle), {\n            x: rightPos[0],\n            y: rightPos[1],\n            r: markSize / 2 || markR || 5\n          }),\n          className: 'link-point-right',\n          name: 'link-point-right'\n        });\n      }\n    }\n\n    if (top) {\n      // up down left right 四个方向的坐标均不相同\n      var topPos = null;\n      var diffY = len * Math.sin(1 / 3 * Math.PI);\n      var r = len * Math.sin(1 / 3 * Math.PI);\n\n      if (direction === 'up') {\n        topPos = [r - diffY, -diffY];\n      } else if (direction === 'left') {\n        topPos = [r, -diffY];\n      } else if (direction === 'right') {\n        topPos = [-r, -diffY];\n      }\n\n      if (topPos) {\n        // top circle\n        group.addShape('circle', {\n          attrs: __assign(__assign({}, markStyle), {\n            x: topPos[0],\n            y: topPos[1],\n            r: markSize / 2 || markR || 5\n          }),\n          className: 'link-point-top',\n          name: 'link-point-top'\n        });\n      }\n    }\n\n    if (bottom) {\n      // up down left right 四个方向的坐标均不相同\n      var bottomPos = null;\n      var diffY = len * Math.sin(1 / 3 * Math.PI);\n      var r = len * Math.sin(1 / 3 * Math.PI);\n\n      if (direction === 'down') {\n        bottomPos = [-r + diffY, diffY];\n      } else if (direction === 'left') {\n        bottomPos = [r, diffY];\n      } else if (direction === 'right') {\n        bottomPos = [-r, diffY];\n      }\n\n      if (bottomPos) {\n        // bottom circle\n        group.addShape('circle', {\n          attrs: __assign(__assign({}, markStyle), {\n            x: bottomPos[0],\n            y: bottomPos[1],\n            r: markSize / 2 || markR || 5\n          }),\n          className: 'link-point-bottom',\n          name: 'link-point-bottom'\n        });\n      }\n    }\n  },\n  getPath: function getPath(cfg) {\n    var defaultDirection = this.getOptions(cfg).direction;\n    var direction = cfg.direction || defaultDirection;\n    var size = this.getSize(cfg);\n    var len = size[0];\n    var diffY = len * Math.sin(1 / 3 * Math.PI);\n    var r = len * Math.sin(1 / 3 * Math.PI);\n    var path = [['M', -r, diffY], ['L', 0, -diffY], ['L', r, diffY], ['Z'] // 封闭\n    ];\n\n    if (direction === 'down') {\n      path = [['M', -r, -diffY], ['L', r, -diffY], ['L', 0, diffY], ['Z'] // 封闭\n      ];\n    } else if (direction === 'left') {\n      path = [['M', -r, r - diffY], ['L', r, -r], ['L', r, r], ['Z'] // 封闭\n      ];\n    } else if (direction === 'right') {\n      path = [['M', r, r - diffY], ['L', -r, r], ['L', -r, -r], ['Z'] // 封闭\n      ];\n    }\n\n    return path;\n  },\n\n  /**\r\n   * 获取节点的样式，供基于该节点自定义时使用\r\n   * @param {Object} cfg 节点数据模型\r\n   * @return {Object} 节点的样式\r\n   */\n  getShapeStyle: function getShapeStyle(cfg) {\n    var defaultStyle = this.getOptions(cfg).style;\n    var strokeStyle = {\n      stroke: cfg.color\n    }; // 如果设置了color，则覆盖默认的stroke属性\n\n    var style = mix({}, defaultStyle, strokeStyle);\n    var path = this.getPath(cfg);\n\n    var styles = __assign({\n      path: path\n    }, style);\n\n    return styles;\n  },\n  update: function update(cfg, item) {\n    var group = item.getContainer(); // 这里不传 cfg 参数是因为 cfg.style 需要最后覆盖样式\n\n    var defaultStyle = this.getOptions({}).style;\n    var path = this.getPath(cfg); // 下面这些属性需要覆盖默认样式与目前样式，但若在 cfg 中有指定则应该被 cfg 的相应配置覆盖。\n\n    var strokeStyle = {\n      stroke: cfg.color,\n      path: path\n    }; // 与 getShapeStyle 不同在于，update 时需要获取到当前的 style 进行融合。即新传入的配置项中没有涉及的属性，保留当前的配置。\n\n    var keyShape = item.get('keyShape');\n    var style = mix({}, defaultStyle, keyShape.attr(), strokeStyle);\n    style = mix(style, cfg.style);\n    this.updateShape(cfg, item, style, true);\n    this.updateLinkPoints(cfg, group);\n  },\n\n  /**\r\n   * 更新linkPoints\r\n   * @param {Object} cfg 节点数据配置项\r\n   * @param {Group} group Item所在的group\r\n   */\n  updateLinkPoints: function updateLinkPoints(cfg, group) {\n    var _a = this.getOptions({}),\n        defaultLinkPoints = _a.linkPoints,\n        defaultDirection = _a.direction;\n\n    var direction = cfg.direction || defaultDirection;\n    var markLeft = group.find(function (element) {\n      return element.get('className') === 'link-point-left';\n    });\n    var markRight = group.find(function (element) {\n      return element.get('className') === 'link-point-right';\n    });\n    var markTop = group.find(function (element) {\n      return element.get('className') === 'link-point-top';\n    });\n    var markBottom = group.find(function (element) {\n      return element.get('className') === 'link-point-bottom';\n    });\n    var currentLinkPoints = defaultLinkPoints;\n    var existLinkPoint = markLeft || markRight || markTop || markBottom;\n\n    if (existLinkPoint) {\n      currentLinkPoints = existLinkPoint.attr();\n    }\n\n    var linkPoints = mix({}, currentLinkPoints, cfg.linkPoints);\n    var markFill = linkPoints.fill,\n        markStroke = linkPoints.stroke,\n        borderWidth = linkPoints.lineWidth;\n    var markSize = linkPoints.size / 2;\n    if (!markSize) markSize = linkPoints.r;\n\n    var _b = cfg.linkPoints ? cfg.linkPoints : {\n      left: undefined,\n      right: undefined,\n      top: undefined,\n      bottom: undefined\n    },\n        left = _b.left,\n        right = _b.right,\n        top = _b.top,\n        bottom = _b.bottom;\n\n    var size = this.getSize(cfg);\n    var len = size[0];\n    var styles = {\n      r: markSize,\n      fill: markFill,\n      stroke: markStroke,\n      lineWidth: borderWidth\n    };\n    var leftPos = null;\n    var diffY = len * Math.sin(1 / 3 * Math.PI);\n    var r = len * Math.sin(1 / 3 * Math.PI);\n\n    if (direction === 'up') {\n      leftPos = [-r, diffY];\n    } else if (direction === 'down') {\n      leftPos = [-r, -diffY];\n    } else if (direction === 'left') {\n      leftPos = [-r, r - diffY];\n    }\n\n    if (leftPos) {\n      if (markLeft) {\n        if (!left && left !== undefined) {\n          markLeft.remove();\n        } else {\n          markLeft.attr(__assign(__assign({}, styles), {\n            x: leftPos[0],\n            y: leftPos[1]\n          }));\n        }\n      } else if (left) {\n        group.addShape('circle', {\n          attrs: __assign(__assign({}, styles), {\n            x: leftPos[0],\n            y: leftPos[1]\n          }),\n          className: 'link-point-left',\n          name: 'link-point-left',\n          isAnchorPoint: true\n        });\n      }\n    }\n\n    var rightPos = null;\n\n    if (direction === 'up') {\n      rightPos = [r, diffY];\n    } else if (direction === 'down') {\n      rightPos = [r, -diffY];\n    } else if (direction === 'right') {\n      rightPos = [r, r - diffY];\n    }\n\n    if (rightPos) {\n      if (markRight) {\n        if (!right && right !== undefined) {\n          markRight.remove();\n        } else {\n          markRight.attr(__assign(__assign({}, styles), {\n            x: rightPos[0],\n            y: rightPos[1]\n          }));\n        }\n      } else if (right) {\n        group.addShape('circle', {\n          attrs: __assign(__assign({}, styles), {\n            x: rightPos[0],\n            y: rightPos[1]\n          }),\n          className: 'link-point-right',\n          name: 'link-point-right',\n          isAnchorPoint: true\n        });\n      }\n    }\n\n    var topPos = null;\n\n    if (direction === 'up') {\n      topPos = [r - diffY, -diffY];\n    } else if (direction === 'left') {\n      topPos = [r, -diffY];\n    } else if (direction === 'right') {\n      topPos = [-r, -diffY];\n    }\n\n    if (topPos) {\n      if (markTop) {\n        if (!top && top !== undefined) {\n          markTop.remove();\n        } else {\n          // top circle\n          markTop.attr(__assign(__assign({}, styles), {\n            x: topPos[0],\n            y: topPos[1]\n          }));\n        }\n      } else if (top) {\n        group.addShape('circle', {\n          attrs: __assign(__assign({}, styles), {\n            x: topPos[0],\n            y: topPos[1]\n          }),\n          className: 'link-point-top',\n          name: 'link-point-top',\n          isAnchorPoint: true\n        });\n      }\n    }\n\n    var bottomPos = null;\n\n    if (direction === 'down') {\n      bottomPos = [-r + diffY, diffY];\n    } else if (direction === 'left') {\n      bottomPos = [r, diffY];\n    } else if (direction === 'right') {\n      bottomPos = [-r, diffY];\n    }\n\n    if (bottomPos) {\n      if (markBottom) {\n        if (!bottom && bottom !== undefined) {\n          markBottom.remove();\n        } else {\n          markBottom.attr(__assign(__assign({}, styles), {\n            x: bottomPos[0],\n            y: bottomPos[1]\n          }));\n        }\n      } else if (bottom) {\n        group.addShape('circle', {\n          attrs: __assign(__assign({}, styles), {\n            x: bottomPos[0],\n            y: bottomPos[1]\n          }),\n          className: 'link-point-bottom',\n          name: 'link-point-bottom',\n          isAnchorPoint: true\n        });\n      }\n    }\n  }\n}, 'single-node');","map":{"version":3,"sources":["E:/sqlindex2/sql/frontend/node_modules/@antv/g6-element/es/nodes/triangle.js"],"names":["__assign","__rest","registerNode","BaseGlobal","Global","mix","options","size","direction","style","stroke","defaultNode","fill","lineWidth","labelCfg","nodeLabel","fontSize","offset","linkPoints","top","right","bottom","left","icon","show","img","width","height","stateStyles","nodeStateStyles","shapeType","labelPosition","drawShape","cfg","group","_a","getOptions","_b","defaultDirection","getShapeStyle","keyShape","addShape","attrs","className","type","name","draggable","w","h","text","x","y","textBaseline","textAlign","iconW","iconH","drawLinkPoints","markSize","markR","r","markStyle","getSize","len","leftPos","diffY","Math","sin","PI","rightPos","topPos","bottomPos","getPath","path","defaultStyle","strokeStyle","color","styles","update","item","getContainer","get","attr","updateShape","updateLinkPoints","defaultLinkPoints","markLeft","find","element","markRight","markTop","markBottom","currentLinkPoints","existLinkPoint","markFill","markStroke","borderWidth","undefined","remove","isAnchorPoint"],"mappings":"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","sourcesContent":["import { __assign, __rest } from \"tslib\";\r\nimport { registerNode, BaseGlobal as Global } from '@antv/g6-core';\r\nimport { mix } from '@antv/util'; // 三角形\r\n\r\nregisterNode('triangle', {\r\n  // 自定义节点时的配置\r\n  options: {\r\n    size: 40,\r\n    direction: 'up',\r\n    style: {\r\n      stroke: Global.defaultNode.style.stroke,\r\n      fill: Global.defaultNode.style.fill,\r\n      lineWidth: Global.defaultNode.style.lineWidth\r\n    },\r\n    labelCfg: {\r\n      style: {\r\n        fill: Global.nodeLabel.style.fill,\r\n        fontSize: Global.nodeLabel.style.fontSize\r\n      },\r\n      offset: 15\r\n    },\r\n    // 节点上左右上下四个方向上的链接circle配置\r\n    linkPoints: {\r\n      top: false,\r\n      right: false,\r\n      bottom: false,\r\n      left: false,\r\n      // circle的大小\r\n      size: Global.defaultNode.linkPoints.size,\r\n      lineWidth: Global.defaultNode.linkPoints.lineWidth,\r\n      fill: Global.defaultNode.linkPoints.fill,\r\n      stroke: Global.defaultNode.linkPoints.stroke\r\n    },\r\n    // 节点中icon配置\r\n    icon: {\r\n      // 是否显示icon，值为 false 则不渲染icon\r\n      show: false,\r\n      // icon的地址，字符串类型\r\n      img: 'https://gw.alipayobjects.com/zos/bmw-prod/5d015065-8505-4e7a-baec-976f81e3c41d.svg',\r\n      width: 20,\r\n      height: 20,\r\n      offset: 6\r\n    },\r\n    stateStyles: __assign({}, Global.nodeStateStyles)\r\n  },\r\n  shapeType: 'triangle',\r\n  // 文本位置\r\n  labelPosition: 'bottom',\r\n  drawShape: function drawShape(cfg, group) {\r\n    var _a = this.getOptions(cfg),\r\n        _b = _a.icon,\r\n        icon = _b === void 0 ? {} : _b,\r\n        defaultDirection = _a.direction;\r\n\r\n    var style = this.getShapeStyle(cfg);\r\n    var direction = cfg.direction || defaultDirection;\r\n    var keyShape = group.addShape('path', {\r\n      attrs: style,\r\n      className: this.type + \"-keyShape\",\r\n      name: this.type + \"-keyShape\",\r\n      draggable: true\r\n    });\r\n    var w = icon.width,\r\n        h = icon.height,\r\n        show = icon.show,\r\n        offset = icon.offset,\r\n        text = icon.text;\r\n\r\n    if (show) {\r\n      if (text) {\r\n        group.addShape('text', {\r\n          attrs: __assign({\r\n            x: 0,\r\n            y: 0,\r\n            fontSize: 12,\r\n            fill: '#000',\r\n            stroke: '#000',\r\n            textBaseline: 'middle',\r\n            textAlign: 'center'\r\n          }, icon),\r\n          className: this.type + \"-icon\",\r\n          name: this.type + \"-icon\",\r\n          draggable: true\r\n        });\r\n      } else {\r\n        var iconW = -w / 2;\r\n        var iconH = -h / 2;\r\n\r\n        if (direction === 'up' || direction === 'down') {\r\n          iconH += offset;\r\n        }\r\n\r\n        if (direction === 'left' || direction === 'right') {\r\n          iconW += offset;\r\n        }\r\n\r\n        group.addShape('image', {\r\n          attrs: __assign({\r\n            x: iconW,\r\n            y: iconH\r\n          }, icon),\r\n          className: this.type + \"-icon\",\r\n          name: this.type + \"-icon\",\r\n          draggable: true\r\n        });\r\n      }\r\n    }\r\n\r\n    this.drawLinkPoints(cfg, group);\r\n    return keyShape;\r\n  },\r\n\r\n  /**\r\n   * 绘制节点上的LinkPoints\r\n   * @param {Object} cfg data数据配置项\r\n   * @param {Group} group Group实例\r\n   */\r\n  drawLinkPoints: function drawLinkPoints(cfg, group) {\r\n    var _a = this.getOptions(cfg),\r\n        _b = _a.linkPoints,\r\n        linkPoints = _b === void 0 ? {} : _b,\r\n        defaultDirection = _a.direction;\r\n\r\n    var direction = cfg.direction || defaultDirection;\r\n\r\n    var top = linkPoints.top,\r\n        left = linkPoints.left,\r\n        right = linkPoints.right,\r\n        bottom = linkPoints.bottom,\r\n        markSize = linkPoints.size,\r\n        markR = linkPoints.r,\r\n        markStyle = __rest(linkPoints, [\"top\", \"left\", \"right\", \"bottom\", \"size\", \"r\"]);\r\n\r\n    var size = this.getSize(cfg);\r\n    var len = size[0];\r\n\r\n    if (left) {\r\n      // up down left right 四个方向的坐标均不相同\r\n      var leftPos = null;\r\n      var diffY = len * Math.sin(1 / 3 * Math.PI);\r\n      var r = len * Math.sin(1 / 3 * Math.PI);\r\n\r\n      if (direction === 'up') {\r\n        leftPos = [-r, diffY];\r\n      } else if (direction === 'down') {\r\n        leftPos = [-r, -diffY];\r\n      } else if (direction === 'left') {\r\n        leftPos = [-r, r - diffY];\r\n      }\r\n\r\n      if (leftPos) {\r\n        // left circle\r\n        group.addShape('circle', {\r\n          attrs: __assign(__assign({}, markStyle), {\r\n            x: leftPos[0],\r\n            y: leftPos[1],\r\n            r: markSize / 2 || markR || 5\r\n          }),\r\n          className: 'link-point-left',\r\n          name: 'link-point-left'\r\n        });\r\n      }\r\n    }\r\n\r\n    if (right) {\r\n      // right circle\r\n      // up down left right 四个方向的坐标均不相同\r\n      var rightPos = null;\r\n      var diffY = len * Math.sin(1 / 3 * Math.PI);\r\n      var r = len * Math.sin(1 / 3 * Math.PI);\r\n\r\n      if (direction === 'up') {\r\n        rightPos = [r, diffY];\r\n      } else if (direction === 'down') {\r\n        rightPos = [r, -diffY];\r\n      } else if (direction === 'right') {\r\n        rightPos = [r, r - diffY];\r\n      }\r\n\r\n      if (rightPos) {\r\n        group.addShape('circle', {\r\n          attrs: __assign(__assign({}, markStyle), {\r\n            x: rightPos[0],\r\n            y: rightPos[1],\r\n            r: markSize / 2 || markR || 5\r\n          }),\r\n          className: 'link-point-right',\r\n          name: 'link-point-right'\r\n        });\r\n      }\r\n    }\r\n\r\n    if (top) {\r\n      // up down left right 四个方向的坐标均不相同\r\n      var topPos = null;\r\n      var diffY = len * Math.sin(1 / 3 * Math.PI);\r\n      var r = len * Math.sin(1 / 3 * Math.PI);\r\n\r\n      if (direction === 'up') {\r\n        topPos = [r - diffY, -diffY];\r\n      } else if (direction === 'left') {\r\n        topPos = [r, -diffY];\r\n      } else if (direction === 'right') {\r\n        topPos = [-r, -diffY];\r\n      }\r\n\r\n      if (topPos) {\r\n        // top circle\r\n        group.addShape('circle', {\r\n          attrs: __assign(__assign({}, markStyle), {\r\n            x: topPos[0],\r\n            y: topPos[1],\r\n            r: markSize / 2 || markR || 5\r\n          }),\r\n          className: 'link-point-top',\r\n          name: 'link-point-top'\r\n        });\r\n      }\r\n    }\r\n\r\n    if (bottom) {\r\n      // up down left right 四个方向的坐标均不相同\r\n      var bottomPos = null;\r\n      var diffY = len * Math.sin(1 / 3 * Math.PI);\r\n      var r = len * Math.sin(1 / 3 * Math.PI);\r\n\r\n      if (direction === 'down') {\r\n        bottomPos = [-r + diffY, diffY];\r\n      } else if (direction === 'left') {\r\n        bottomPos = [r, diffY];\r\n      } else if (direction === 'right') {\r\n        bottomPos = [-r, diffY];\r\n      }\r\n\r\n      if (bottomPos) {\r\n        // bottom circle\r\n        group.addShape('circle', {\r\n          attrs: __assign(__assign({}, markStyle), {\r\n            x: bottomPos[0],\r\n            y: bottomPos[1],\r\n            r: markSize / 2 || markR || 5\r\n          }),\r\n          className: 'link-point-bottom',\r\n          name: 'link-point-bottom'\r\n        });\r\n      }\r\n    }\r\n  },\r\n  getPath: function getPath(cfg) {\r\n    var defaultDirection = this.getOptions(cfg).direction;\r\n    var direction = cfg.direction || defaultDirection;\r\n    var size = this.getSize(cfg);\r\n    var len = size[0];\r\n    var diffY = len * Math.sin(1 / 3 * Math.PI);\r\n    var r = len * Math.sin(1 / 3 * Math.PI);\r\n    var path = [['M', -r, diffY], ['L', 0, -diffY], ['L', r, diffY], ['Z'] // 封闭\r\n    ];\r\n\r\n    if (direction === 'down') {\r\n      path = [['M', -r, -diffY], ['L', r, -diffY], ['L', 0, diffY], ['Z'] // 封闭\r\n      ];\r\n    } else if (direction === 'left') {\r\n      path = [['M', -r, r - diffY], ['L', r, -r], ['L', r, r], ['Z'] // 封闭\r\n      ];\r\n    } else if (direction === 'right') {\r\n      path = [['M', r, r - diffY], ['L', -r, r], ['L', -r, -r], ['Z'] // 封闭\r\n      ];\r\n    }\r\n\r\n    return path;\r\n  },\r\n\r\n  /**\r\n   * 获取节点的样式，供基于该节点自定义时使用\r\n   * @param {Object} cfg 节点数据模型\r\n   * @return {Object} 节点的样式\r\n   */\r\n  getShapeStyle: function getShapeStyle(cfg) {\r\n    var defaultStyle = this.getOptions(cfg).style;\r\n    var strokeStyle = {\r\n      stroke: cfg.color\r\n    }; // 如果设置了color，则覆盖默认的stroke属性\r\n\r\n    var style = mix({}, defaultStyle, strokeStyle);\r\n    var path = this.getPath(cfg);\r\n\r\n    var styles = __assign({\r\n      path: path\r\n    }, style);\r\n\r\n    return styles;\r\n  },\r\n  update: function update(cfg, item) {\r\n    var group = item.getContainer(); // 这里不传 cfg 参数是因为 cfg.style 需要最后覆盖样式\r\n\r\n    var defaultStyle = this.getOptions({}).style;\r\n    var path = this.getPath(cfg); // 下面这些属性需要覆盖默认样式与目前样式，但若在 cfg 中有指定则应该被 cfg 的相应配置覆盖。\r\n\r\n    var strokeStyle = {\r\n      stroke: cfg.color,\r\n      path: path\r\n    }; // 与 getShapeStyle 不同在于，update 时需要获取到当前的 style 进行融合。即新传入的配置项中没有涉及的属性，保留当前的配置。\r\n\r\n    var keyShape = item.get('keyShape');\r\n    var style = mix({}, defaultStyle, keyShape.attr(), strokeStyle);\r\n    style = mix(style, cfg.style);\r\n    this.updateShape(cfg, item, style, true);\r\n    this.updateLinkPoints(cfg, group);\r\n  },\r\n\r\n  /**\r\n   * 更新linkPoints\r\n   * @param {Object} cfg 节点数据配置项\r\n   * @param {Group} group Item所在的group\r\n   */\r\n  updateLinkPoints: function updateLinkPoints(cfg, group) {\r\n    var _a = this.getOptions({}),\r\n        defaultLinkPoints = _a.linkPoints,\r\n        defaultDirection = _a.direction;\r\n\r\n    var direction = cfg.direction || defaultDirection;\r\n    var markLeft = group.find(function (element) {\r\n      return element.get('className') === 'link-point-left';\r\n    });\r\n    var markRight = group.find(function (element) {\r\n      return element.get('className') === 'link-point-right';\r\n    });\r\n    var markTop = group.find(function (element) {\r\n      return element.get('className') === 'link-point-top';\r\n    });\r\n    var markBottom = group.find(function (element) {\r\n      return element.get('className') === 'link-point-bottom';\r\n    });\r\n    var currentLinkPoints = defaultLinkPoints;\r\n    var existLinkPoint = markLeft || markRight || markTop || markBottom;\r\n\r\n    if (existLinkPoint) {\r\n      currentLinkPoints = existLinkPoint.attr();\r\n    }\r\n\r\n    var linkPoints = mix({}, currentLinkPoints, cfg.linkPoints);\r\n    var markFill = linkPoints.fill,\r\n        markStroke = linkPoints.stroke,\r\n        borderWidth = linkPoints.lineWidth;\r\n    var markSize = linkPoints.size / 2;\r\n    if (!markSize) markSize = linkPoints.r;\r\n\r\n    var _b = cfg.linkPoints ? cfg.linkPoints : {\r\n      left: undefined,\r\n      right: undefined,\r\n      top: undefined,\r\n      bottom: undefined\r\n    },\r\n        left = _b.left,\r\n        right = _b.right,\r\n        top = _b.top,\r\n        bottom = _b.bottom;\r\n\r\n    var size = this.getSize(cfg);\r\n    var len = size[0];\r\n    var styles = {\r\n      r: markSize,\r\n      fill: markFill,\r\n      stroke: markStroke,\r\n      lineWidth: borderWidth\r\n    };\r\n    var leftPos = null;\r\n    var diffY = len * Math.sin(1 / 3 * Math.PI);\r\n    var r = len * Math.sin(1 / 3 * Math.PI);\r\n\r\n    if (direction === 'up') {\r\n      leftPos = [-r, diffY];\r\n    } else if (direction === 'down') {\r\n      leftPos = [-r, -diffY];\r\n    } else if (direction === 'left') {\r\n      leftPos = [-r, r - diffY];\r\n    }\r\n\r\n    if (leftPos) {\r\n      if (markLeft) {\r\n        if (!left && left !== undefined) {\r\n          markLeft.remove();\r\n        } else {\r\n          markLeft.attr(__assign(__assign({}, styles), {\r\n            x: leftPos[0],\r\n            y: leftPos[1]\r\n          }));\r\n        }\r\n      } else if (left) {\r\n        group.addShape('circle', {\r\n          attrs: __assign(__assign({}, styles), {\r\n            x: leftPos[0],\r\n            y: leftPos[1]\r\n          }),\r\n          className: 'link-point-left',\r\n          name: 'link-point-left',\r\n          isAnchorPoint: true\r\n        });\r\n      }\r\n    }\r\n\r\n    var rightPos = null;\r\n\r\n    if (direction === 'up') {\r\n      rightPos = [r, diffY];\r\n    } else if (direction === 'down') {\r\n      rightPos = [r, -diffY];\r\n    } else if (direction === 'right') {\r\n      rightPos = [r, r - diffY];\r\n    }\r\n\r\n    if (rightPos) {\r\n      if (markRight) {\r\n        if (!right && right !== undefined) {\r\n          markRight.remove();\r\n        } else {\r\n          markRight.attr(__assign(__assign({}, styles), {\r\n            x: rightPos[0],\r\n            y: rightPos[1]\r\n          }));\r\n        }\r\n      } else if (right) {\r\n        group.addShape('circle', {\r\n          attrs: __assign(__assign({}, styles), {\r\n            x: rightPos[0],\r\n            y: rightPos[1]\r\n          }),\r\n          className: 'link-point-right',\r\n          name: 'link-point-right',\r\n          isAnchorPoint: true\r\n        });\r\n      }\r\n    }\r\n\r\n    var topPos = null;\r\n\r\n    if (direction === 'up') {\r\n      topPos = [r - diffY, -diffY];\r\n    } else if (direction === 'left') {\r\n      topPos = [r, -diffY];\r\n    } else if (direction === 'right') {\r\n      topPos = [-r, -diffY];\r\n    }\r\n\r\n    if (topPos) {\r\n      if (markTop) {\r\n        if (!top && top !== undefined) {\r\n          markTop.remove();\r\n        } else {\r\n          // top circle\r\n          markTop.attr(__assign(__assign({}, styles), {\r\n            x: topPos[0],\r\n            y: topPos[1]\r\n          }));\r\n        }\r\n      } else if (top) {\r\n        group.addShape('circle', {\r\n          attrs: __assign(__assign({}, styles), {\r\n            x: topPos[0],\r\n            y: topPos[1]\r\n          }),\r\n          className: 'link-point-top',\r\n          name: 'link-point-top',\r\n          isAnchorPoint: true\r\n        });\r\n      }\r\n    }\r\n\r\n    var bottomPos = null;\r\n\r\n    if (direction === 'down') {\r\n      bottomPos = [-r + diffY, diffY];\r\n    } else if (direction === 'left') {\r\n      bottomPos = [r, diffY];\r\n    } else if (direction === 'right') {\r\n      bottomPos = [-r, diffY];\r\n    }\r\n\r\n    if (bottomPos) {\r\n      if (markBottom) {\r\n        if (!bottom && bottom !== undefined) {\r\n          markBottom.remove();\r\n        } else {\r\n          markBottom.attr(__assign(__assign({}, styles), {\r\n            x: bottomPos[0],\r\n            y: bottomPos[1]\r\n          }));\r\n        }\r\n      } else if (bottom) {\r\n        group.addShape('circle', {\r\n          attrs: __assign(__assign({}, styles), {\r\n            x: bottomPos[0],\r\n            y: bottomPos[1]\r\n          }),\r\n          className: 'link-point-bottom',\r\n          name: 'link-point-bottom',\r\n          isAnchorPoint: true\r\n        });\r\n      }\r\n    }\r\n  }\r\n}, 'single-node');"]},"metadata":{},"sourceType":"module"}