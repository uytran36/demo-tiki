{"ast":null,"code":"import { __assign } from \"tslib\";\nimport { deepMix, isString } from '@antv/util';\nimport { parsePathString } from '@antv/path-util';\nimport { pathToPoints, getClosedSpline, roundedHull, paddedHull } from '../util/path';\nimport { isPolygonsIntersect } from '../util/math';\nimport { genConvexHull } from '../element/hull/convexHull';\nimport { genBubbleSet } from '../element/hull/bubbleset';\n/**\r\n * 用于包裹内部的成员的轮廓。\r\n * convex hull(凸包)：http://geomalgorithms.com/a10-_hull-1.html#Monotone%20Chain\r\n * bubble: 使用 bubbleset算法，refer: http://vialab.science.uoit.ca/wp-content/papercite-data/pdf/col2009c.pdf\r\n * 通过配置 padding 可以调节包裹轮廓对节点的松紧程度\r\n */\n\nvar Hull =\n/** @class */\nfunction () {\n  function Hull(graph, cfg) {\n    this.cfg = deepMix(this.getDefaultCfg(), cfg);\n    this.graph = graph;\n    this.id = this.cfg.id;\n    this.group = this.cfg.group;\n    this.members = this.cfg.members.map(function (item) {\n      return isString(item) ? graph.findById(item) : item;\n    });\n    this.nonMembers = this.cfg.nonMembers.map(function (item) {\n      return isString(item) ? graph.findById(item) : item;\n    });\n    this.setPadding();\n    this.setType();\n    this.path = this.calcPath(this.members, this.nonMembers);\n    this.render();\n  }\n\n  Hull.prototype.getDefaultCfg = function () {\n    return {\n      id: 'g6-hull',\n      type: 'round-convex',\n      members: [],\n      nonMembers: [],\n      style: {\n        fill: 'lightblue',\n        stroke: 'blue',\n        opacity: 0.2\n      },\n      padding: 10\n    };\n  };\n\n  Hull.prototype.setPadding = function () {\n    var nodeSize = this.members.length && this.members[0].getKeyShape().getCanvasBBox().width / 2;\n    this.padding = this.cfg.padding > 0 ? this.cfg.padding + nodeSize : 10 + nodeSize;\n    this.cfg.bubbleCfg = {\n      nodeR0: this.padding - nodeSize,\n      nodeR1: this.padding - nodeSize,\n      morphBuffer: this.padding - nodeSize\n    };\n  };\n\n  Hull.prototype.setType = function () {\n    this.type = this.cfg.type;\n\n    if (this.members.length < 3) {\n      this.type = 'round-convex';\n    }\n\n    if (this.type !== 'round-convex' && this.type !== 'smooth-convex' && this.type !== 'bubble') {\n      console.warn('The hull type should be either round-convex, smooth-convex or bubble, round-convex is used by default.');\n      this.type = 'round-convex';\n    }\n  };\n\n  Hull.prototype.calcPath = function (members, nonMembers) {\n    var contour, path, hull;\n\n    switch (this.type) {\n      case 'round-convex':\n        contour = genConvexHull(members);\n        hull = roundedHull(contour.map(function (p) {\n          return [p.x, p.y];\n        }), this.padding);\n        path = parsePathString(hull);\n        break;\n\n      case 'smooth-convex':\n        contour = genConvexHull(members);\n\n        if (contour.length === 2) {\n          hull = roundedHull(contour.map(function (p) {\n            return [p.x, p.y];\n          }), this.padding);\n          path = parsePathString(hull);\n        } else if (contour.length > 2) {\n          hull = paddedHull(contour.map(function (p) {\n            return [p.x, p.y];\n          }), this.padding);\n          path = getClosedSpline(hull);\n        }\n\n        break;\n\n      case 'bubble':\n        contour = genBubbleSet(members, nonMembers, this.cfg.bubbleCfg);\n        path = contour.length >= 2 && getClosedSpline(contour);\n        break;\n\n      default:\n    }\n\n    return path;\n  };\n\n  Hull.prototype.render = function () {\n    this.group.addShape('path', {\n      attrs: __assign({\n        path: this.path\n      }, this.cfg.style),\n      id: this.id,\n      name: this.cfg.id\n    });\n    this.group.toBack();\n  };\n  /**\r\n   * 增加hull的成员，同时如果该成员原先在nonMembers中，则从nonMembers中去掉\r\n   * @param item 节点实例\r\n   * @return boolean 添加成功返回 true，否则返回 false\r\n   */\n\n\n  Hull.prototype.addMember = function (item) {\n    if (!item) return;\n    if (isString(item)) item = this.graph.findById(item);\n    this.members.push(item);\n    var index = this.nonMembers.indexOf(item);\n\n    if (index > -1) {\n      this.nonMembers.splice(index, 1);\n    }\n\n    this.updateData(this.members, this.nonMembers);\n    return true;\n  };\n  /**\r\n   * 增加hull需要排除的节点，同时如果该成员原先在members中，则从members中去掉\r\n   * @param item 节点实例\r\n   * @return boolean 添加成功返回 true，否则返回 false\r\n   */\n\n\n  Hull.prototype.addNonMember = function (item) {\n    if (!item) return;\n    if (isString(item)) item = this.graph.findById(item);\n    this.nonMembers.push(item);\n    var index = this.members.indexOf(item);\n\n    if (index > -1) {\n      this.members.splice(index, 1);\n    }\n\n    this.updateData(this.members, this.nonMembers);\n    return true;\n  };\n  /**\r\n   * 移除hull中的成员\r\n   * @param node 节点实例\r\n   * @return boolean 移除成功返回 true，否则返回 false\r\n   */\n\n\n  Hull.prototype.removeMember = function (item) {\n    if (!item) return;\n    if (isString(item)) item = this.graph.findById(item);\n    var index = this.members.indexOf(item);\n\n    if (index > -1) {\n      this.members.splice(index, 1);\n      this.updateData(this.members, this.nonMembers);\n      return true;\n    }\n\n    return false;\n  };\n  /**\r\n   * @param node 节点实例\r\n   * @return boolean 移除成功返回 true，否则返回 false\r\n   */\n\n\n  Hull.prototype.removeNonMember = function (item) {\n    if (!item) return;\n    if (isString(item)) item = this.graph.findById(item);\n    var index = this.nonMembers.indexOf(item);\n\n    if (index > -1) {\n      this.nonMembers.splice(index, 1);\n      this.updateData(this.members, this.nonMembers);\n      return true;\n    }\n\n    return false;\n  };\n\n  Hull.prototype.updateData = function (members, nonMembers) {\n    var _this = this;\n\n    this.group.findById(this.id).remove();\n    if (members) this.members = members.map(function (item) {\n      return isString(item) ? _this.graph.findById(item) : item;\n    });\n    if (nonMembers) this.nonMembers = nonMembers.map(function (item) {\n      return isString(item) ? _this.graph.findById(item) : item;\n    });\n    this.path = this.calcPath(this.members, this.nonMembers);\n    this.render();\n  };\n\n  Hull.prototype.updateStyle = function (cfg) {\n    var path = this.group.findById(this.id);\n    path.attr(__assign({}, cfg));\n  };\n  /**\r\n   * 更新 hull\r\n   * @param cfg hull 配置项\r\n   */\n\n\n  Hull.prototype.updateCfg = function (cfg) {\n    var _this = this;\n\n    this.cfg = deepMix(this.cfg, cfg);\n    this.id = this.cfg.id;\n    this.group = this.cfg.group;\n\n    if (cfg.members) {\n      this.members = this.cfg.members.map(function (item) {\n        return isString(item) ? _this.graph.findById(item) : item;\n      });\n    }\n\n    if (cfg.nonMembers) {\n      this.nonMembers = this.cfg.nonMembers.map(function (item) {\n        return isString(item) ? _this.graph.findById(item) : item;\n      });\n    } // TODO padding 设置太大，会影响到 contain 结果\n\n\n    this.setPadding();\n    this.setType();\n    this.path = this.calcPath(this.members, this.nonMembers);\n    this.render();\n  };\n  /**\r\n   * 判断是否在hull内部\r\n   * @param item\r\n   */\n\n\n  Hull.prototype.contain = function (item) {\n    var _this = this;\n\n    var nodeItem;\n\n    if (isString(item)) {\n      nodeItem = this.graph.findById(item);\n    } else {\n      nodeItem = item;\n    }\n\n    var shapePoints;\n    var shape = nodeItem.getKeyShape();\n\n    if (nodeItem.get('type') === 'path') {\n      shapePoints = pathToPoints(shape.attr('path'));\n    } else {\n      var shapeBBox = shape.getCanvasBBox();\n      shapePoints = [[shapeBBox.minX, shapeBBox.minY], [shapeBBox.maxX, shapeBBox.minY], [shapeBBox.maxX, shapeBBox.maxY], [shapeBBox.minX, shapeBBox.maxY]];\n    }\n\n    shapePoints = shapePoints.map(function (canvasPoint) {\n      var point = _this.graph.getPointByCanvas(canvasPoint[0], canvasPoint[1]);\n\n      return [point.x, point.y];\n    });\n    return isPolygonsIntersect(shapePoints, pathToPoints(this.path));\n  };\n\n  Hull.prototype.destroy = function () {\n    this.group.remove();\n    this.cfg = null;\n  };\n\n  return Hull;\n}();\n\nexport default Hull;","map":{"version":3,"sources":["D:/SQL/sqlindex2/sql/frontend/node_modules/@antv/g6-core/es/item/hull.js"],"names":["__assign","deepMix","isString","parsePathString","pathToPoints","getClosedSpline","roundedHull","paddedHull","isPolygonsIntersect","genConvexHull","genBubbleSet","Hull","graph","cfg","getDefaultCfg","id","group","members","map","item","findById","nonMembers","setPadding","setType","path","calcPath","render","prototype","type","style","fill","stroke","opacity","padding","nodeSize","length","getKeyShape","getCanvasBBox","width","bubbleCfg","nodeR0","nodeR1","morphBuffer","console","warn","contour","hull","p","x","y","addShape","attrs","name","toBack","addMember","push","index","indexOf","splice","updateData","addNonMember","removeMember","removeNonMember","_this","remove","updateStyle","attr","updateCfg","contain","nodeItem","shapePoints","shape","get","shapeBBox","minX","minY","maxX","maxY","canvasPoint","point","getPointByCanvas","destroy"],"mappings":"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","sourcesContent":["import { __assign } from \"tslib\";\r\nimport { deepMix, isString } from '@antv/util';\r\nimport { parsePathString } from '@antv/path-util';\r\nimport { pathToPoints, getClosedSpline, roundedHull, paddedHull } from '../util/path';\r\nimport { isPolygonsIntersect } from '../util/math';\r\nimport { genConvexHull } from '../element/hull/convexHull';\r\nimport { genBubbleSet } from '../element/hull/bubbleset';\r\n/**\r\n * 用于包裹内部的成员的轮廓。\r\n * convex hull(凸包)：http://geomalgorithms.com/a10-_hull-1.html#Monotone%20Chain\r\n * bubble: 使用 bubbleset算法，refer: http://vialab.science.uoit.ca/wp-content/papercite-data/pdf/col2009c.pdf\r\n * 通过配置 padding 可以调节包裹轮廓对节点的松紧程度\r\n */\r\n\r\nvar Hull =\r\n/** @class */\r\nfunction () {\r\n  function Hull(graph, cfg) {\r\n    this.cfg = deepMix(this.getDefaultCfg(), cfg);\r\n    this.graph = graph;\r\n    this.id = this.cfg.id;\r\n    this.group = this.cfg.group;\r\n    this.members = this.cfg.members.map(function (item) {\r\n      return isString(item) ? graph.findById(item) : item;\r\n    });\r\n    this.nonMembers = this.cfg.nonMembers.map(function (item) {\r\n      return isString(item) ? graph.findById(item) : item;\r\n    });\r\n    this.setPadding();\r\n    this.setType();\r\n    this.path = this.calcPath(this.members, this.nonMembers);\r\n    this.render();\r\n  }\r\n\r\n  Hull.prototype.getDefaultCfg = function () {\r\n    return {\r\n      id: 'g6-hull',\r\n      type: 'round-convex',\r\n      members: [],\r\n      nonMembers: [],\r\n      style: {\r\n        fill: 'lightblue',\r\n        stroke: 'blue',\r\n        opacity: 0.2\r\n      },\r\n      padding: 10\r\n    };\r\n  };\r\n\r\n  Hull.prototype.setPadding = function () {\r\n    var nodeSize = this.members.length && this.members[0].getKeyShape().getCanvasBBox().width / 2;\r\n    this.padding = this.cfg.padding > 0 ? this.cfg.padding + nodeSize : 10 + nodeSize;\r\n    this.cfg.bubbleCfg = {\r\n      nodeR0: this.padding - nodeSize,\r\n      nodeR1: this.padding - nodeSize,\r\n      morphBuffer: this.padding - nodeSize\r\n    };\r\n  };\r\n\r\n  Hull.prototype.setType = function () {\r\n    this.type = this.cfg.type;\r\n\r\n    if (this.members.length < 3) {\r\n      this.type = 'round-convex';\r\n    }\r\n\r\n    if (this.type !== 'round-convex' && this.type !== 'smooth-convex' && this.type !== 'bubble') {\r\n      console.warn('The hull type should be either round-convex, smooth-convex or bubble, round-convex is used by default.');\r\n      this.type = 'round-convex';\r\n    }\r\n  };\r\n\r\n  Hull.prototype.calcPath = function (members, nonMembers) {\r\n    var contour, path, hull;\r\n\r\n    switch (this.type) {\r\n      case 'round-convex':\r\n        contour = genConvexHull(members);\r\n        hull = roundedHull(contour.map(function (p) {\r\n          return [p.x, p.y];\r\n        }), this.padding);\r\n        path = parsePathString(hull);\r\n        break;\r\n\r\n      case 'smooth-convex':\r\n        contour = genConvexHull(members);\r\n\r\n        if (contour.length === 2) {\r\n          hull = roundedHull(contour.map(function (p) {\r\n            return [p.x, p.y];\r\n          }), this.padding);\r\n          path = parsePathString(hull);\r\n        } else if (contour.length > 2) {\r\n          hull = paddedHull(contour.map(function (p) {\r\n            return [p.x, p.y];\r\n          }), this.padding);\r\n          path = getClosedSpline(hull);\r\n        }\r\n\r\n        break;\r\n\r\n      case 'bubble':\r\n        contour = genBubbleSet(members, nonMembers, this.cfg.bubbleCfg);\r\n        path = contour.length >= 2 && getClosedSpline(contour);\r\n        break;\r\n\r\n      default:\r\n    }\r\n\r\n    return path;\r\n  };\r\n\r\n  Hull.prototype.render = function () {\r\n    this.group.addShape('path', {\r\n      attrs: __assign({\r\n        path: this.path\r\n      }, this.cfg.style),\r\n      id: this.id,\r\n      name: this.cfg.id\r\n    });\r\n    this.group.toBack();\r\n  };\r\n  /**\r\n   * 增加hull的成员，同时如果该成员原先在nonMembers中，则从nonMembers中去掉\r\n   * @param item 节点实例\r\n   * @return boolean 添加成功返回 true，否则返回 false\r\n   */\r\n\r\n\r\n  Hull.prototype.addMember = function (item) {\r\n    if (!item) return;\r\n    if (isString(item)) item = this.graph.findById(item);\r\n    this.members.push(item);\r\n    var index = this.nonMembers.indexOf(item);\r\n\r\n    if (index > -1) {\r\n      this.nonMembers.splice(index, 1);\r\n    }\r\n\r\n    this.updateData(this.members, this.nonMembers);\r\n    return true;\r\n  };\r\n  /**\r\n   * 增加hull需要排除的节点，同时如果该成员原先在members中，则从members中去掉\r\n   * @param item 节点实例\r\n   * @return boolean 添加成功返回 true，否则返回 false\r\n   */\r\n\r\n\r\n  Hull.prototype.addNonMember = function (item) {\r\n    if (!item) return;\r\n    if (isString(item)) item = this.graph.findById(item);\r\n    this.nonMembers.push(item);\r\n    var index = this.members.indexOf(item);\r\n\r\n    if (index > -1) {\r\n      this.members.splice(index, 1);\r\n    }\r\n\r\n    this.updateData(this.members, this.nonMembers);\r\n    return true;\r\n  };\r\n  /**\r\n   * 移除hull中的成员\r\n   * @param node 节点实例\r\n   * @return boolean 移除成功返回 true，否则返回 false\r\n   */\r\n\r\n\r\n  Hull.prototype.removeMember = function (item) {\r\n    if (!item) return;\r\n    if (isString(item)) item = this.graph.findById(item);\r\n    var index = this.members.indexOf(item);\r\n\r\n    if (index > -1) {\r\n      this.members.splice(index, 1);\r\n      this.updateData(this.members, this.nonMembers);\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  };\r\n  /**\r\n   * @param node 节点实例\r\n   * @return boolean 移除成功返回 true，否则返回 false\r\n   */\r\n\r\n\r\n  Hull.prototype.removeNonMember = function (item) {\r\n    if (!item) return;\r\n    if (isString(item)) item = this.graph.findById(item);\r\n    var index = this.nonMembers.indexOf(item);\r\n\r\n    if (index > -1) {\r\n      this.nonMembers.splice(index, 1);\r\n      this.updateData(this.members, this.nonMembers);\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  };\r\n\r\n  Hull.prototype.updateData = function (members, nonMembers) {\r\n    var _this = this;\r\n\r\n    this.group.findById(this.id).remove();\r\n    if (members) this.members = members.map(function (item) {\r\n      return isString(item) ? _this.graph.findById(item) : item;\r\n    });\r\n    if (nonMembers) this.nonMembers = nonMembers.map(function (item) {\r\n      return isString(item) ? _this.graph.findById(item) : item;\r\n    });\r\n    this.path = this.calcPath(this.members, this.nonMembers);\r\n    this.render();\r\n  };\r\n\r\n  Hull.prototype.updateStyle = function (cfg) {\r\n    var path = this.group.findById(this.id);\r\n    path.attr(__assign({}, cfg));\r\n  };\r\n  /**\r\n   * 更新 hull\r\n   * @param cfg hull 配置项\r\n   */\r\n\r\n\r\n  Hull.prototype.updateCfg = function (cfg) {\r\n    var _this = this;\r\n\r\n    this.cfg = deepMix(this.cfg, cfg);\r\n    this.id = this.cfg.id;\r\n    this.group = this.cfg.group;\r\n\r\n    if (cfg.members) {\r\n      this.members = this.cfg.members.map(function (item) {\r\n        return isString(item) ? _this.graph.findById(item) : item;\r\n      });\r\n    }\r\n\r\n    if (cfg.nonMembers) {\r\n      this.nonMembers = this.cfg.nonMembers.map(function (item) {\r\n        return isString(item) ? _this.graph.findById(item) : item;\r\n      });\r\n    } // TODO padding 设置太大，会影响到 contain 结果\r\n\r\n\r\n    this.setPadding();\r\n    this.setType();\r\n    this.path = this.calcPath(this.members, this.nonMembers);\r\n    this.render();\r\n  };\r\n  /**\r\n   * 判断是否在hull内部\r\n   * @param item\r\n   */\r\n\r\n\r\n  Hull.prototype.contain = function (item) {\r\n    var _this = this;\r\n\r\n    var nodeItem;\r\n\r\n    if (isString(item)) {\r\n      nodeItem = this.graph.findById(item);\r\n    } else {\r\n      nodeItem = item;\r\n    }\r\n\r\n    var shapePoints;\r\n    var shape = nodeItem.getKeyShape();\r\n\r\n    if (nodeItem.get('type') === 'path') {\r\n      shapePoints = pathToPoints(shape.attr('path'));\r\n    } else {\r\n      var shapeBBox = shape.getCanvasBBox();\r\n      shapePoints = [[shapeBBox.minX, shapeBBox.minY], [shapeBBox.maxX, shapeBBox.minY], [shapeBBox.maxX, shapeBBox.maxY], [shapeBBox.minX, shapeBBox.maxY]];\r\n    }\r\n\r\n    shapePoints = shapePoints.map(function (canvasPoint) {\r\n      var point = _this.graph.getPointByCanvas(canvasPoint[0], canvasPoint[1]);\r\n\r\n      return [point.x, point.y];\r\n    });\r\n    return isPolygonsIntersect(shapePoints, pathToPoints(this.path));\r\n  };\r\n\r\n  Hull.prototype.destroy = function () {\r\n    this.group.remove();\r\n    this.cfg = null;\r\n  };\r\n\r\n  return Hull;\r\n}();\r\n\r\nexport default Hull;"]},"metadata":{},"sourceType":"module"}