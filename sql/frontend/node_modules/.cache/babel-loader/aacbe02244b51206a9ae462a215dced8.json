{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nimport G6 from '@antv/g6';\nimport { defaultMargin, defaultLabelStyle } from '../constants';\nimport { getStyle, getCssPadding, getSize, getArrowCfg, createMarker } from '../utils'; // 资金流向图\n\nexport var registerFundFlowItems = function () {\n  // 注册节点\n  G6.registerNode('fund-card', {\n    // @ts-ignore\n    draw: function (cfg, group) {\n      if (cfg === void 0) {\n        cfg = {};\n      }\n\n      var _a = cfg.value,\n          value = _a === void 0 ? {} : _a,\n          nodeCfg = cfg.nodeCfg,\n          markerCfg = cfg.markerCfg;\n      var _b = nodeCfg,\n          _c = _b.label,\n          label = _c === void 0 ? {} : _c,\n          style = _b.style,\n          _d = _b.padding,\n          padding = _d === void 0 ? 0 : _d,\n          customContent = _b.customContent;\n      var labelStyle = label.style;\n      var paddingArray = getCssPadding(padding);\n      var size = getSize(cfg.size);\n      var height = 0; // 统计容器总高度，动态设置\n\n      var shapeWidth = size[0];\n      var contentWidth = shapeWidth - paddingArray[1] - paddingArray[3];\n      var contentHeight = size[1] - paddingArray[0] - paddingArray[2]; // card box\n\n      var cardStyle = getStyle(style, cfg, group);\n      var shape = group.addShape('rect', {\n        attrs: __assign({\n          x: 0,\n          y: 0,\n          width: size[0],\n          height: size[1],\n          radius: size[1] / 2,\n          fill: '#fff',\n          stroke: '#40a9ff'\n        }, cardStyle),\n        name: 'main-box',\n        draggable: true\n      });\n\n      if (value) {\n        height += paddingArray[0];\n\n        var createRowItems_1 = function (item, contentWidth, startX) {\n          var _a, _b;\n\n          var text = item.text,\n              icon = item.icon;\n          var textShape, iconShape;\n\n          if (icon) {\n            iconShape = group.addShape('image', {\n              attrs: __assign({\n                x: startX,\n                y: height,\n                img: icon,\n                width: contentHeight,\n                height: contentHeight\n              }, getStyle(labelStyle, cfg, group, 'icon')),\n              name: 'fund-icon'\n            });\n          }\n\n          textShape = group === null || group === void 0 ? void 0 : group.addShape('text', {\n            attrs: __assign(__assign({\n              textBaseline: 'middle',\n              textAlign: iconShape ? 'start' : 'center',\n              x: startX + (iconShape ? (iconShape === null || iconShape === void 0 ? void 0 : iconShape.getBBox().width) + defaultMargin : contentWidth / 2),\n              y: paddingArray[0] + contentHeight / 2,\n              text: text\n            }, defaultLabelStyle), getStyle(labelStyle, cfg, group, 'text')),\n            name: \"fund-text\"\n          });\n          return [(_a = textShape === null || textShape === void 0 ? void 0 : textShape.getBBox().height) !== null && _a !== void 0 ? _a : 0, (_b = iconShape === null || iconShape === void 0 ? void 0 : iconShape.getBBox().height) !== null && _b !== void 0 ? _b : 0];\n        };\n\n        var createItems = function (item) {\n          var _a;\n\n          var itemsHeight = [];\n\n          if (customContent) {\n            itemsHeight.push((_a = customContent(item, group, {\n              startX: paddingArray[3],\n              startY: height,\n              width: contentWidth\n            })) !== null && _a !== void 0 ? _a : 0);\n          } else {\n            itemsHeight.push.apply(itemsHeight, createRowItems_1(item, contentWidth, paddingArray[3]));\n          }\n\n          height += Math.max.apply(Math, itemsHeight);\n        };\n\n        createItems(value);\n      }\n\n      shape === null || shape === void 0 ? void 0 : shape.attr('height', Math.max(size[1], height + paddingArray[2])); // collapse marker\n\n      if (markerCfg) {\n        var _e = shape.getBBox(),\n            shapeWidth_1 = _e.width,\n            shapeHeight = _e.height;\n\n        var _f = typeof markerCfg === 'function' ? markerCfg(cfg, group) : markerCfg,\n            show = _f.show,\n            _g = _f.position,\n            position = _g === void 0 ? 'right' : _g,\n            collapsed = _f.collapsed,\n            markerStyle = _f.style;\n\n        createMarker({\n          show: show,\n          position: position,\n          collapsed: collapsed,\n          style: markerStyle\n        }, group, [shapeWidth_1, shapeHeight]);\n        shape.attr('defaultCollapsed', collapsed);\n      }\n\n      return shape;\n    },\n\n    /**\r\n     * 更新节点，包含文本\r\n     * @override\r\n     * @param  {Object} cfg 节点的配置项\r\n     * @param  {Node} node 节点\r\n     */\n    update: function (cfg, node) {\n      var group = node.getContainer();\n      var markerShape = group.get('children').find(function (item) {\n        return item.get('type') === 'marker';\n      });\n      var collapsed = node.getModel().collapsed;\n      markerShape === null || markerShape === void 0 ? void 0 : markerShape.attr({\n        symbol: collapsed ? G6.Marker.expand : G6.Marker.collapse\n      });\n    }\n  }, 'single-node'); // 注册边\n\n  G6.registerEdge('fund-polyline', {\n    // @ts-ignore\n    draw: function draw(cfg, group) {\n      if (cfg === void 0) {\n        cfg = {};\n      }\n\n      var edgeCfg = cfg.edgeCfg,\n          value = cfg.value;\n      var text;\n      var subText;\n\n      if (value instanceof Object) {\n        text = value.text;\n        subText = value.subText;\n      } else {\n        text = value;\n      }\n\n      var startPoint = cfg.startPoint;\n      var endPoint = cfg.endPoint;\n      var startX = startPoint.x,\n          startY = startPoint.y;\n      var endX = endPoint.x,\n          endY = endPoint.y;\n      var Ydiff = endY - startY;\n      var slope = Ydiff !== 0 ? Math.min(500 / Math.abs(Ydiff), 20) : 0;\n      var cpOffset = slope > 15 ? 0 : 16;\n      var offset = Ydiff < 0 ? cpOffset : -cpOffset;\n      var line1EndPoint = {\n        x: startX + slope,\n        y: endY + offset\n      };\n      var line2StartPoint = {\n        x: line1EndPoint.x + cpOffset,\n        y: endY\n      }; // 控制点坐标\n\n      var controlPoint = {\n        x: (line1EndPoint.x - startX) * (endY - startY) / (line1EndPoint.y - startY) + startX,\n        y: endY\n      };\n      var path = [['M', startX, startY], ['L', line1EndPoint.x, line1EndPoint.y], ['Q', controlPoint.x, controlPoint.y, line2StartPoint.x, line2StartPoint.y], ['L', endX, endY]];\n\n      if (Math.abs(Ydiff) <= 5) {\n        path = [['M', startX, startY], ['L', endX, endY]];\n      }\n\n      var _a = edgeCfg,\n          edgeStyle = _a.style,\n          startArrowCfg = _a.startArrow,\n          endArrowCfg = _a.endArrow,\n          labelCfg = _a.label;\n      var startArrow = getArrowCfg(startArrowCfg, cfg);\n      var endArrow = getArrowCfg(endArrowCfg, cfg);\n      var labelStyle = (labelCfg !== null && labelCfg !== void 0 ? labelCfg : {}).style;\n      var line = group.addShape('path', {\n        attrs: __assign({\n          path: path,\n          stroke: '#ccc',\n          startArrow: startArrow,\n          endArrow: endArrow\n        }, typeof edgeStyle === 'function' ? edgeStyle(cfg, group) : edgeStyle),\n        name: 'path-shape'\n      });\n\n      var createItem = function (itemText, key) {\n        group.addShape('text', {\n          attrs: __assign(__assign({\n            text: itemText,\n            x: line2StartPoint.x,\n            y: key === 'text' ? endY - 4 : endY + 16\n          }, defaultLabelStyle), getStyle(labelStyle, cfg, group, key)),\n          name: \"line-text-\" + key\n        });\n      };\n\n      text && createItem(text, 'text');\n      subText && createItem(subText, 'subText');\n      return line;\n    },\n    update: undefined\n  }, 'single-edge');\n};","map":{"version":3,"sources":["E:/sqlindex2/sql/frontend/node_modules/@ant-design/charts/es/graphs/fundFlowGraph/customItem.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","G6","defaultMargin","defaultLabelStyle","getStyle","getCssPadding","getSize","getArrowCfg","createMarker","registerFundFlowItems","registerNode","draw","cfg","group","_a","value","nodeCfg","markerCfg","_b","_c","label","style","_d","padding","customContent","labelStyle","paddingArray","size","height","shapeWidth","contentWidth","contentHeight","cardStyle","shape","addShape","attrs","x","y","width","radius","fill","stroke","name","draggable","createRowItems_1","item","startX","text","icon","textShape","iconShape","img","textBaseline","textAlign","getBBox","createItems","itemsHeight","push","startY","Math","max","attr","_e","shapeWidth_1","shapeHeight","_f","show","_g","position","collapsed","markerStyle","update","node","getContainer","markerShape","get","find","getModel","symbol","Marker","expand","collapse","registerEdge","edgeCfg","subText","startPoint","endPoint","endX","endY","Ydiff","slope","min","abs","cpOffset","offset","line1EndPoint","line2StartPoint","controlPoint","path","edgeStyle","startArrowCfg","startArrow","endArrowCfg","endArrow","labelCfg","line","createItem","itemText","key","undefined"],"mappings":"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","sourcesContent":["var __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nimport G6 from '@antv/g6';\r\nimport { defaultMargin, defaultLabelStyle } from '../constants';\r\nimport { getStyle, getCssPadding, getSize, getArrowCfg, createMarker } from '../utils';\r\n// 资金流向图\r\nexport var registerFundFlowItems = function () {\r\n    // 注册节点\r\n    G6.registerNode('fund-card', {\r\n        // @ts-ignore\r\n        draw: function (cfg, group) {\r\n            if (cfg === void 0) { cfg = {}; }\r\n            var _a = cfg.value, value = _a === void 0 ? {} : _a, nodeCfg = cfg.nodeCfg, markerCfg = cfg.markerCfg;\r\n            var _b = nodeCfg, _c = _b.label, label = _c === void 0 ? {} : _c, style = _b.style, _d = _b.padding, padding = _d === void 0 ? 0 : _d, customContent = _b.customContent;\r\n            var labelStyle = label.style;\r\n            var paddingArray = getCssPadding(padding);\r\n            var size = getSize(cfg.size);\r\n            var height = 0; // 统计容器总高度，动态设置\r\n            var shapeWidth = size[0];\r\n            var contentWidth = shapeWidth - paddingArray[1] - paddingArray[3];\r\n            var contentHeight = size[1] - paddingArray[0] - paddingArray[2];\r\n            // card box\r\n            var cardStyle = getStyle(style, cfg, group);\r\n            var shape = group.addShape('rect', {\r\n                attrs: __assign({ x: 0, y: 0, width: size[0], height: size[1], radius: size[1] / 2, fill: '#fff', stroke: '#40a9ff' }, cardStyle),\r\n                name: 'main-box',\r\n                draggable: true,\r\n            });\r\n            if (value) {\r\n                height += paddingArray[0];\r\n                var createRowItems_1 = function (item, contentWidth, startX) {\r\n                    var _a, _b;\r\n                    var text = item.text, icon = item.icon;\r\n                    var textShape, iconShape;\r\n                    if (icon) {\r\n                        iconShape = group.addShape('image', {\r\n                            attrs: __assign({ x: startX, y: height, img: icon, width: contentHeight, height: contentHeight }, getStyle(labelStyle, cfg, group, 'icon')),\r\n                            name: 'fund-icon',\r\n                        });\r\n                    }\r\n                    textShape = group === null || group === void 0 ? void 0 : group.addShape('text', {\r\n                        attrs: __assign(__assign({ textBaseline: 'middle', textAlign: iconShape ? 'start' : 'center', x: startX +\r\n                                (iconShape ? (iconShape === null || iconShape === void 0 ? void 0 : iconShape.getBBox().width) + defaultMargin : contentWidth / 2), y: paddingArray[0] + contentHeight / 2, text: text }, defaultLabelStyle), getStyle(labelStyle, cfg, group, 'text')),\r\n                        name: \"fund-text\",\r\n                    });\r\n                    return [(_a = textShape === null || textShape === void 0 ? void 0 : textShape.getBBox().height) !== null && _a !== void 0 ? _a : 0, (_b = iconShape === null || iconShape === void 0 ? void 0 : iconShape.getBBox().height) !== null && _b !== void 0 ? _b : 0];\r\n                };\r\n                var createItems = function (item) {\r\n                    var _a;\r\n                    var itemsHeight = [];\r\n                    if (customContent) {\r\n                        itemsHeight.push((_a = customContent(item, group, {\r\n                            startX: paddingArray[3],\r\n                            startY: height,\r\n                            width: contentWidth,\r\n                        })) !== null && _a !== void 0 ? _a : 0);\r\n                    }\r\n                    else {\r\n                        itemsHeight.push.apply(itemsHeight, createRowItems_1(item, contentWidth, paddingArray[3]));\r\n                    }\r\n                    height += Math.max.apply(Math, itemsHeight);\r\n                };\r\n                createItems(value);\r\n            }\r\n            shape === null || shape === void 0 ? void 0 : shape.attr('height', Math.max(size[1], height + paddingArray[2]));\r\n            // collapse marker\r\n            if (markerCfg) {\r\n                var _e = shape.getBBox(), shapeWidth_1 = _e.width, shapeHeight = _e.height;\r\n                var _f = typeof markerCfg === 'function' ? markerCfg(cfg, group) : markerCfg, show = _f.show, _g = _f.position, position = _g === void 0 ? 'right' : _g, collapsed = _f.collapsed, markerStyle = _f.style;\r\n                createMarker({\r\n                    show: show,\r\n                    position: position,\r\n                    collapsed: collapsed,\r\n                    style: markerStyle,\r\n                }, group, [shapeWidth_1, shapeHeight]);\r\n                shape.attr('defaultCollapsed', collapsed);\r\n            }\r\n            return shape;\r\n        },\r\n        /**\r\n         * 更新节点，包含文本\r\n         * @override\r\n         * @param  {Object} cfg 节点的配置项\r\n         * @param  {Node} node 节点\r\n         */\r\n        update: function (cfg, node) {\r\n            var group = node.getContainer();\r\n            var markerShape = group\r\n                .get('children')\r\n                .find(function (item) { return item.get('type') === 'marker'; });\r\n            var collapsed = node.getModel().collapsed;\r\n            markerShape === null || markerShape === void 0 ? void 0 : markerShape.attr({\r\n                symbol: collapsed ? G6.Marker.expand : G6.Marker.collapse,\r\n            });\r\n        },\r\n    }, 'single-node');\r\n    // 注册边\r\n    G6.registerEdge('fund-polyline', {\r\n        // @ts-ignore\r\n        draw: function draw(cfg, group) {\r\n            if (cfg === void 0) { cfg = {}; }\r\n            var edgeCfg = cfg.edgeCfg, value = cfg.value;\r\n            var text;\r\n            var subText;\r\n            if (value instanceof Object) {\r\n                text = value.text;\r\n                subText = value.subText;\r\n            }\r\n            else {\r\n                text = value;\r\n            }\r\n            var startPoint = cfg.startPoint;\r\n            var endPoint = cfg.endPoint;\r\n            var startX = startPoint.x, startY = startPoint.y;\r\n            var endX = endPoint.x, endY = endPoint.y;\r\n            var Ydiff = endY - startY;\r\n            var slope = Ydiff !== 0 ? Math.min(500 / Math.abs(Ydiff), 20) : 0;\r\n            var cpOffset = slope > 15 ? 0 : 16;\r\n            var offset = Ydiff < 0 ? cpOffset : -cpOffset;\r\n            var line1EndPoint = {\r\n                x: startX + slope,\r\n                y: endY + offset,\r\n            };\r\n            var line2StartPoint = {\r\n                x: line1EndPoint.x + cpOffset,\r\n                y: endY,\r\n            };\r\n            // 控制点坐标\r\n            var controlPoint = {\r\n                x: ((line1EndPoint.x - startX) * (endY - startY)) / (line1EndPoint.y - startY) + startX,\r\n                y: endY,\r\n            };\r\n            var path = [\r\n                ['M', startX, startY],\r\n                ['L', line1EndPoint.x, line1EndPoint.y],\r\n                ['Q', controlPoint.x, controlPoint.y, line2StartPoint.x, line2StartPoint.y],\r\n                ['L', endX, endY],\r\n            ];\r\n            if (Math.abs(Ydiff) <= 5) {\r\n                path = [\r\n                    ['M', startX, startY],\r\n                    ['L', endX, endY],\r\n                ];\r\n            }\r\n            var _a = edgeCfg, edgeStyle = _a.style, startArrowCfg = _a.startArrow, endArrowCfg = _a.endArrow, labelCfg = _a.label;\r\n            var startArrow = getArrowCfg(startArrowCfg, cfg);\r\n            var endArrow = getArrowCfg(endArrowCfg, cfg);\r\n            var labelStyle = (labelCfg !== null && labelCfg !== void 0 ? labelCfg : {}).style;\r\n            var line = group.addShape('path', {\r\n                attrs: __assign({ path: path, stroke: '#ccc', startArrow: startArrow, endArrow: endArrow }, (typeof edgeStyle === 'function' ? edgeStyle(cfg, group) : edgeStyle)),\r\n                name: 'path-shape',\r\n            });\r\n            var createItem = function (itemText, key) {\r\n                group.addShape('text', {\r\n                    attrs: __assign(__assign({ text: itemText, x: line2StartPoint.x, y: key === 'text' ? endY - 4 : endY + 16 }, defaultLabelStyle), getStyle(labelStyle, cfg, group, key)),\r\n                    name: \"line-text-\" + key,\r\n                });\r\n            };\r\n            text && createItem(text, 'text');\r\n            subText && createItem(subText, 'subText');\r\n            return line;\r\n        },\r\n        update: undefined,\r\n    }, 'single-edge');\r\n};\r\n"]},"metadata":{},"sourceType":"module"}