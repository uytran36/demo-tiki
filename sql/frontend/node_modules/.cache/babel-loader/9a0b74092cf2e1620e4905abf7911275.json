{"ast":null,"code":"import { __assign } from \"tslib\";\nimport { isArray } from '@antv/util';\nimport { flow, findGeometry } from '../../../utils';\nimport { getTooltipMapping } from '../../../utils/tooltip';\nimport { geometry as baseGeometry } from '../../../adaptor/geometries/base';\nimport { FUNNEL_CONVERSATION, FUNNEL_PERCENT, FUNNEL_MAPPING_VALUE } from '../constant';\nimport { conversionTagComponent, transformData } from './common';\n/**\r\n * 处理字段数据\r\n * @param params\r\n */\n\nfunction field(params) {\n  var chart = params.chart,\n      options = params.options;\n  var _a = options.data,\n      data = _a === void 0 ? [] : _a,\n      yField = options.yField,\n      maxSize = options.maxSize,\n      minSize = options.minSize;\n  var formatData = transformData(data, data, {\n    yField: yField,\n    maxSize: maxSize,\n    minSize: minSize\n  }); // 绘制漏斗图\n\n  chart.data(formatData);\n  return params;\n}\n/**\r\n * geometry处理\r\n * @param params\r\n */\n\n\nfunction geometry(params) {\n  var chart = params.chart,\n      options = params.options;\n  var xField = options.xField,\n      yField = options.yField,\n      color = options.color,\n      tooltip = options.tooltip,\n      label = options.label,\n      _a = options.shape,\n      shape = _a === void 0 ? 'funnel' : _a,\n      funnelStyle = options.funnelStyle,\n      state = options.state;\n\n  var _b = getTooltipMapping(tooltip, [xField, yField]),\n      fields = _b.fields,\n      formatter = _b.formatter;\n\n  baseGeometry({\n    chart: chart,\n    options: {\n      type: 'interval',\n      xField: xField,\n      yField: FUNNEL_MAPPING_VALUE,\n      colorField: xField,\n      tooltipFields: isArray(fields) && fields.concat([FUNNEL_PERCENT, FUNNEL_CONVERSATION]),\n      mapping: {\n        shape: shape,\n        tooltip: formatter,\n        color: color,\n        style: funnelStyle\n      },\n      label: label,\n      state: state\n    }\n  });\n  var geo = findGeometry(params.chart, 'interval');\n  geo.adjust('symmetric');\n  return params;\n}\n/**\r\n * 转置处理\r\n * @param params\r\n */\n\n\nfunction transpose(params) {\n  var chart = params.chart,\n      options = params.options;\n  var isTransposed = options.isTransposed;\n  chart.coordinate({\n    type: 'rect',\n    actions: !isTransposed ? [['transpose'], ['scale', 1, -1]] : []\n  });\n  return params;\n}\n/**\r\n * 转化率组件\r\n * @param params\r\n */\n\n\nfunction conversionTag(params) {\n  var options = params.options;\n  var maxSize = options.maxSize;\n\n  var getLineCoordinate = function (datum, datumIndex, data, initLineOption) {\n    var percent = maxSize - (maxSize - datum[FUNNEL_MAPPING_VALUE]) / 2;\n    return __assign(__assign({}, initLineOption), {\n      start: [datumIndex - 0.5, percent],\n      end: [datumIndex - 0.5, percent + 0.05]\n    });\n  };\n\n  conversionTagComponent(getLineCoordinate)(params);\n  return params;\n}\n/**\r\n * 基础漏斗\r\n * @param chart\r\n * @param options\r\n */\n\n\nexport function basicFunnel(params) {\n  return flow(field, geometry, transpose, conversionTag)(params);\n}","map":{"version":3,"sources":["../../../../src/plots/funnel/geometries/basic.ts"],"names":[],"mappings":"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","sourcesContent":["import { Types } from '@antv/g2';\nimport { isArray } from '@antv/util';\nimport { flow, findGeometry } from '../../../utils';\nimport { getTooltipMapping } from '../../../utils/tooltip';\nimport { Params } from '../../../core/adaptor';\nimport { Datum, Data } from '../../../types/common';\nimport { geometry as baseGeometry } from '../../../adaptor/geometries/base';\nimport { FunnelOptions } from '../types';\nimport { FUNNEL_CONVERSATION, FUNNEL_PERCENT, FUNNEL_MAPPING_VALUE } from '../constant';\nimport { conversionTagComponent, transformData } from './common';\n\n/**\n * 处理字段数据\n * @param params\n */\nfunction field(params: Params<FunnelOptions>): Params<FunnelOptions> {\n  const { chart, options } = params;\n  const { data = [], yField, maxSize, minSize } = options;\n  const formatData = transformData(data, data, {\n    yField,\n    maxSize,\n    minSize,\n  });\n\n  // 绘制漏斗图\n  chart.data(formatData);\n  return params;\n}\n\n/**\n * geometry处理\n * @param params\n */\nfunction geometry(params: Params<FunnelOptions>): Params<FunnelOptions> {\n  const { chart, options } = params;\n  const { xField, yField, color, tooltip, label, shape = 'funnel', funnelStyle } = options;\n\n  const { fields, formatter } = getTooltipMapping(tooltip, [xField, yField]);\n\n  baseGeometry({\n    chart,\n    options: {\n      type: 'interval',\n      xField: xField,\n      yField: FUNNEL_MAPPING_VALUE,\n      colorField: xField,\n      tooltipFields: isArray(fields) && fields.concat([FUNNEL_PERCENT, FUNNEL_CONVERSATION]),\n      mapping: {\n        shape,\n        tooltip: formatter,\n        color,\n        style: funnelStyle,\n      },\n      label,\n    },\n  });\n\n  const geo = findGeometry(params.chart, 'interval');\n  geo.adjust('symmetric');\n\n  return params;\n}\n\n/**\n * 转置处理\n * @param params\n */\nfunction transpose(params: Params<FunnelOptions>): Params<FunnelOptions> {\n  const { chart, options } = params;\n  const { isTransposed } = options;\n  chart.coordinate({\n    type: 'rect',\n    actions: !isTransposed ? [['transpose'], ['scale', 1, -1]] : [],\n  });\n  return params;\n}\n\n/**\n * 转化率组件\n * @param params\n */\nfunction conversionTag(params: Params<FunnelOptions>): Params<FunnelOptions> {\n  const { options } = params;\n  const { maxSize } = options;\n\n  const getLineCoordinate = (\n    datum: Datum,\n    datumIndex: number,\n    data: Data,\n    initLineOption: Record<string, any>\n  ): Types.LineOption => {\n    const percent = maxSize - (maxSize - datum[FUNNEL_MAPPING_VALUE]) / 2;\n    return {\n      ...initLineOption,\n      start: [datumIndex - 0.5, percent],\n      end: [datumIndex - 0.5, percent + 0.05],\n    };\n  };\n\n  conversionTagComponent(getLineCoordinate)(params);\n\n  return params;\n}\n\n/**\n * 基础漏斗\n * @param chart\n * @param options\n */\nexport function basicFunnel(params: Params<FunnelOptions>) {\n  return flow(field, geometry, transpose, conversionTag)(params);\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}