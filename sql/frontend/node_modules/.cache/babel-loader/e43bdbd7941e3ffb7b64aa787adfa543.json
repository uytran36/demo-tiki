{"ast":null,"code":"import { __extends } from \"tslib\";\nimport { isString, isPlainObject, isNil, mix } from '@antv/util';\nimport Item from './item';\nvar END_MAP = {\n  source: 'start',\n  target: 'end'\n};\nvar ITEM_NAME_SUFFIX = 'Node'; // 端点的后缀，如 sourceNode, targetNode\n\nvar POINT_NAME_SUFFIX = 'Point'; // 起点或者结束点的后缀，如 startPoint, endPoint\n\nvar ANCHOR_NAME_SUFFIX = 'Anchor';\n\nvar Edge =\n/** @class */\nfunction (_super) {\n  __extends(Edge, _super);\n\n  function Edge() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  Edge.prototype.getDefaultCfg = function () {\n    return {\n      type: 'edge',\n      sourceNode: null,\n      targetNode: null,\n      startPoint: null,\n      endPoint: null,\n      linkCenter: false\n    };\n  };\n\n  Edge.prototype.setEnd = function (name, value) {\n    var pointName = END_MAP[name] + POINT_NAME_SUFFIX;\n    var itemName = name + ITEM_NAME_SUFFIX;\n    var preItem = this.get(itemName);\n\n    if (preItem && !preItem.destroyed) {\n      // 如果之前存在节点，则移除掉边\n      preItem.removeEdge(this);\n    }\n\n    if (isPlainObject(value)) {\n      // 如果设置成具体的点，则清理节点\n      this.set(pointName, value);\n      this.set(itemName, null);\n    } else if (value) {\n      value.addEdge(this);\n      this.set(itemName, value);\n      this.set(pointName, null);\n    }\n  };\n  /**\r\n   * 获取连接点的坐标\r\n   * @param name source | target\r\n   * @param model 边的数据模型\r\n   * @param controlPoints 控制点\r\n   */\n\n\n  Edge.prototype.getLinkPoint = function (name, model, controlPoints) {\n    var pointName = END_MAP[name] + POINT_NAME_SUFFIX;\n    var itemName = name + ITEM_NAME_SUFFIX;\n    var point = this.get(pointName);\n\n    if (!point) {\n      var item = this.get(itemName);\n      var anchorName = name + ANCHOR_NAME_SUFFIX;\n      var prePoint = this.getPrePoint(name, controlPoints);\n      var anchorIndex = model[anchorName];\n\n      if (!isNil(anchorIndex)) {\n        // 如果有锚点，则使用锚点索引获取连接点\n        point = item.getLinkPointByAnchor(anchorIndex);\n      } // 如果锚点没有对应的点或者没有锚点，则直接计算连接点\n\n\n      point = point || item.getLinkPoint(prePoint);\n\n      if (!isNil(point.index)) {\n        this.set(name + \"AnchorIndex\", point.index);\n      }\n    }\n\n    return point;\n  };\n  /**\r\n   * 获取同端点进行连接的点，计算交汇点\r\n   * @param name\r\n   * @param controlPoints\r\n   */\n\n\n  Edge.prototype.getPrePoint = function (name, controlPoints) {\n    if (controlPoints && controlPoints.length) {\n      var index = name === 'source' ? 0 : controlPoints.length - 1;\n      return controlPoints[index];\n    }\n\n    var oppositeName = name === 'source' ? 'target' : 'source'; // 取另一个节点的位置\n\n    return this.getEndPoint(oppositeName);\n  };\n  /**\r\n   * 获取端点的位置\r\n   * @param name\r\n   */\n\n\n  Edge.prototype.getEndPoint = function (name) {\n    var itemName = name + ITEM_NAME_SUFFIX;\n    var pointName = END_MAP[name] + POINT_NAME_SUFFIX;\n    var item = this.get(itemName); // 如果有端点，直接使用 model\n\n    if (item) {\n      return item.get('model');\n    } // 否则直接使用点\n\n\n    return this.get(pointName);\n  };\n  /**\r\n   * 通过端点的中心获取控制点\r\n   * @param model\r\n   */\n\n\n  Edge.prototype.getControlPointsByCenter = function (model) {\n    var sourcePoint = this.getEndPoint('source');\n    var targetPoint = this.getEndPoint('target');\n    var shapeFactory = this.get('shapeFactory');\n    var type = model.type;\n    return shapeFactory.getControlPoints(type, {\n      startPoint: sourcePoint,\n      endPoint: targetPoint\n    });\n  };\n\n  Edge.prototype.getEndCenter = function (name) {\n    var itemName = name + ITEM_NAME_SUFFIX;\n    var pointName = END_MAP[name] + POINT_NAME_SUFFIX;\n    var item = this.get(itemName); // 如果有端点，直接使用 model\n\n    if (item) {\n      var bbox = item.getBBox();\n      return {\n        x: bbox.centerX,\n        y: bbox.centerY\n      };\n    } // 否则直接使用点\n\n\n    return this.get(pointName);\n  };\n\n  Edge.prototype.init = function () {\n    _super.prototype.init.call(this); // 初始化两个端点\n\n\n    this.setSource(this.get('source'));\n    this.setTarget(this.get('target'));\n  };\n\n  Edge.prototype.getShapeCfg = function (model) {\n    var self = this;\n    var linkCenter = self.get('linkCenter'); // 如果连接到中心，忽视锚点、忽视控制点\n\n    var cfg = _super.prototype.getShapeCfg.call(this, model);\n\n    if (linkCenter) {\n      cfg.startPoint = self.getEndCenter('source');\n      cfg.endPoint = self.getEndCenter('target');\n    } else {\n      var controlPoints = cfg.controlPoints || self.getControlPointsByCenter(cfg);\n      cfg.startPoint = self.getLinkPoint('source', model, controlPoints);\n      cfg.endPoint = self.getLinkPoint('target', model, controlPoints);\n    }\n\n    cfg.sourceNode = self.get('sourceNode');\n    cfg.targetNode = self.get('targetNode');\n    return cfg;\n  };\n  /**\r\n   * 获取边的数据模型\r\n   */\n\n\n  Edge.prototype.getModel = function () {\n    var out = this.get('model');\n    var sourceItem = this.get(\"source\" + ITEM_NAME_SUFFIX);\n    var targetItem = this.get(\"target\" + ITEM_NAME_SUFFIX);\n\n    if (sourceItem) {\n      delete out[\"source\" + ITEM_NAME_SUFFIX];\n    } else {\n      out.source = this.get(\"start\" + POINT_NAME_SUFFIX);\n    }\n\n    if (targetItem) {\n      delete out[\"target\" + ITEM_NAME_SUFFIX];\n    } else {\n      out.target = this.get(\"end\" + POINT_NAME_SUFFIX);\n    }\n\n    if (!isString(out.source) && !isPlainObject(out.source)) {\n      out.source = out.source.getID();\n    }\n\n    if (!isString(out.target) && !isPlainObject(out.target)) {\n      out.target = out.target.getID();\n    }\n\n    return out;\n  };\n\n  Edge.prototype.setSource = function (source) {\n    this.setEnd('source', source);\n    this.set('source', source);\n  };\n\n  Edge.prototype.setTarget = function (target) {\n    this.setEnd('target', target);\n    this.set('target', target);\n  };\n\n  Edge.prototype.getSource = function () {\n    return this.get('source');\n  };\n\n  Edge.prototype.getTarget = function () {\n    return this.get('target');\n  };\n\n  Edge.prototype.updatePosition = function () {\n    return false;\n  };\n  /**\r\n   * 边不需要重计算容器位置，直接重新计算 path 位置\r\n   * @param {object} cfg 待更新数据\r\n   */\n\n\n  Edge.prototype.update = function (cfg, onlyMove) {\n    if (onlyMove === void 0) {\n      onlyMove = false;\n    }\n\n    var model = this.get('model');\n    var oriVisible = model.visible;\n    var cfgVisible = cfg.visible;\n    if (oriVisible !== cfgVisible && cfgVisible !== undefined) this.changeVisibility(cfgVisible);\n    var styles = this.get('styles');\n\n    if (cfg.stateStyles) {\n      // 更新 item 时更新 this.get('styles') 中的值\n      var stateStyles = cfg.stateStyles;\n      mix(styles, stateStyles);\n      delete cfg.stateStyles;\n    }\n\n    Object.assign(model, cfg);\n    this.updateShape();\n    this.afterUpdate();\n    this.clearCache();\n  };\n\n  Edge.prototype.destroy = function () {\n    var sourceItem = this.get(\"source\" + ITEM_NAME_SUFFIX);\n    var targetItem = this.get(\"target\" + ITEM_NAME_SUFFIX);\n\n    if (sourceItem && !sourceItem.destroyed) {\n      sourceItem.removeEdge(this);\n    }\n\n    if (targetItem && !targetItem.destroyed) {\n      targetItem.removeEdge(this);\n    }\n\n    _super.prototype.destroy.call(this);\n  };\n\n  return Edge;\n}(Item);\n\nexport default Edge;","map":{"version":3,"sources":["D:/SQL/sqlindex2/sql/frontend/node_modules/@antv/g6-core/es/item/edge.js"],"names":["__extends","isString","isPlainObject","isNil","mix","Item","END_MAP","source","target","ITEM_NAME_SUFFIX","POINT_NAME_SUFFIX","ANCHOR_NAME_SUFFIX","Edge","_super","apply","arguments","prototype","getDefaultCfg","type","sourceNode","targetNode","startPoint","endPoint","linkCenter","setEnd","name","value","pointName","itemName","preItem","get","destroyed","removeEdge","set","addEdge","getLinkPoint","model","controlPoints","point","item","anchorName","prePoint","getPrePoint","anchorIndex","getLinkPointByAnchor","index","length","oppositeName","getEndPoint","getControlPointsByCenter","sourcePoint","targetPoint","shapeFactory","getControlPoints","getEndCenter","bbox","getBBox","x","centerX","y","centerY","init","call","setSource","setTarget","getShapeCfg","self","cfg","getModel","out","sourceItem","targetItem","getID","getSource","getTarget","updatePosition","update","onlyMove","oriVisible","visible","cfgVisible","undefined","changeVisibility","styles","stateStyles","Object","assign","updateShape","afterUpdate","clearCache","destroy"],"mappings":"AAAA,SAASA,SAAT,QAA0B,OAA1B;AACA,SAASC,QAAT,EAAmBC,aAAnB,EAAkCC,KAAlC,EAAyCC,GAAzC,QAAoD,YAApD;AACA,OAAOC,IAAP,MAAiB,QAAjB;AACA,IAAIC,OAAO,GAAG;AACZC,EAAAA,MAAM,EAAE,OADI;AAEZC,EAAAA,MAAM,EAAE;AAFI,CAAd;AAIA,IAAIC,gBAAgB,GAAG,MAAvB,C,CAA+B;;AAE/B,IAAIC,iBAAiB,GAAG,OAAxB,C,CAAiC;;AAEjC,IAAIC,kBAAkB,GAAG,QAAzB;;AAEA,IAAIC,IAAI;AACR;AACA,UAAUC,MAAV,EAAkB;AAChBb,EAAAA,SAAS,CAACY,IAAD,EAAOC,MAAP,CAAT;;AAEA,WAASD,IAAT,GAAgB;AACd,WAAOC,MAAM,KAAK,IAAX,IAAmBA,MAAM,CAACC,KAAP,CAAa,IAAb,EAAmBC,SAAnB,CAAnB,IAAoD,IAA3D;AACD;;AAEDH,EAAAA,IAAI,CAACI,SAAL,CAAeC,aAAf,GAA+B,YAAY;AACzC,WAAO;AACLC,MAAAA,IAAI,EAAE,MADD;AAELC,MAAAA,UAAU,EAAE,IAFP;AAGLC,MAAAA,UAAU,EAAE,IAHP;AAILC,MAAAA,UAAU,EAAE,IAJP;AAKLC,MAAAA,QAAQ,EAAE,IALL;AAMLC,MAAAA,UAAU,EAAE;AANP,KAAP;AAQD,GATD;;AAWAX,EAAAA,IAAI,CAACI,SAAL,CAAeQ,MAAf,GAAwB,UAAUC,IAAV,EAAgBC,KAAhB,EAAuB;AAC7C,QAAIC,SAAS,GAAGrB,OAAO,CAACmB,IAAD,CAAP,GAAgBf,iBAAhC;AACA,QAAIkB,QAAQ,GAAGH,IAAI,GAAGhB,gBAAtB;AACA,QAAIoB,OAAO,GAAG,KAAKC,GAAL,CAASF,QAAT,CAAd;;AAEA,QAAIC,OAAO,IAAI,CAACA,OAAO,CAACE,SAAxB,EAAmC;AACjC;AACAF,MAAAA,OAAO,CAACG,UAAR,CAAmB,IAAnB;AACD;;AAED,QAAI9B,aAAa,CAACwB,KAAD,CAAjB,EAA0B;AACxB;AACA,WAAKO,GAAL,CAASN,SAAT,EAAoBD,KAApB;AACA,WAAKO,GAAL,CAASL,QAAT,EAAmB,IAAnB;AACD,KAJD,MAIO,IAAIF,KAAJ,EAAW;AAChBA,MAAAA,KAAK,CAACQ,OAAN,CAAc,IAAd;AACA,WAAKD,GAAL,CAASL,QAAT,EAAmBF,KAAnB;AACA,WAAKO,GAAL,CAASN,SAAT,EAAoB,IAApB;AACD;AACF,GAnBD;AAoBA;AACF;AACA;AACA;AACA;AACA;;;AAGEf,EAAAA,IAAI,CAACI,SAAL,CAAemB,YAAf,GAA8B,UAAUV,IAAV,EAAgBW,KAAhB,EAAuBC,aAAvB,EAAsC;AAClE,QAAIV,SAAS,GAAGrB,OAAO,CAACmB,IAAD,CAAP,GAAgBf,iBAAhC;AACA,QAAIkB,QAAQ,GAAGH,IAAI,GAAGhB,gBAAtB;AACA,QAAI6B,KAAK,GAAG,KAAKR,GAAL,CAASH,SAAT,CAAZ;;AAEA,QAAI,CAACW,KAAL,EAAY;AACV,UAAIC,IAAI,GAAG,KAAKT,GAAL,CAASF,QAAT,CAAX;AACA,UAAIY,UAAU,GAAGf,IAAI,GAAGd,kBAAxB;AACA,UAAI8B,QAAQ,GAAG,KAAKC,WAAL,CAAiBjB,IAAjB,EAAuBY,aAAvB,CAAf;AACA,UAAIM,WAAW,GAAGP,KAAK,CAACI,UAAD,CAAvB;;AAEA,UAAI,CAACrC,KAAK,CAACwC,WAAD,CAAV,EAAyB;AACvB;AACAL,QAAAA,KAAK,GAAGC,IAAI,CAACK,oBAAL,CAA0BD,WAA1B,CAAR;AACD,OATS,CASR;;;AAGFL,MAAAA,KAAK,GAAGA,KAAK,IAAIC,IAAI,CAACJ,YAAL,CAAkBM,QAAlB,CAAjB;;AAEA,UAAI,CAACtC,KAAK,CAACmC,KAAK,CAACO,KAAP,CAAV,EAAyB;AACvB,aAAKZ,GAAL,CAASR,IAAI,GAAG,aAAhB,EAA+Ba,KAAK,CAACO,KAArC;AACD;AACF;;AAED,WAAOP,KAAP;AACD,GAzBD;AA0BA;AACF;AACA;AACA;AACA;;;AAGE1B,EAAAA,IAAI,CAACI,SAAL,CAAe0B,WAAf,GAA6B,UAAUjB,IAAV,EAAgBY,aAAhB,EAA+B;AAC1D,QAAIA,aAAa,IAAIA,aAAa,CAACS,MAAnC,EAA2C;AACzC,UAAID,KAAK,GAAGpB,IAAI,KAAK,QAAT,GAAoB,CAApB,GAAwBY,aAAa,CAACS,MAAd,GAAuB,CAA3D;AACA,aAAOT,aAAa,CAACQ,KAAD,CAApB;AACD;;AAED,QAAIE,YAAY,GAAGtB,IAAI,KAAK,QAAT,GAAoB,QAApB,GAA+B,QAAlD,CAN0D,CAME;;AAE5D,WAAO,KAAKuB,WAAL,CAAiBD,YAAjB,CAAP;AACD,GATD;AAUA;AACF;AACA;AACA;;;AAGEnC,EAAAA,IAAI,CAACI,SAAL,CAAegC,WAAf,GAA6B,UAAUvB,IAAV,EAAgB;AAC3C,QAAIG,QAAQ,GAAGH,IAAI,GAAGhB,gBAAtB;AACA,QAAIkB,SAAS,GAAGrB,OAAO,CAACmB,IAAD,CAAP,GAAgBf,iBAAhC;AACA,QAAI6B,IAAI,GAAG,KAAKT,GAAL,CAASF,QAAT,CAAX,CAH2C,CAGZ;;AAE/B,QAAIW,IAAJ,EAAU;AACR,aAAOA,IAAI,CAACT,GAAL,CAAS,OAAT,CAAP;AACD,KAP0C,CAOzC;;;AAGF,WAAO,KAAKA,GAAL,CAASH,SAAT,CAAP;AACD,GAXD;AAYA;AACF;AACA;AACA;;;AAGEf,EAAAA,IAAI,CAACI,SAAL,CAAeiC,wBAAf,GAA0C,UAAUb,KAAV,EAAiB;AACzD,QAAIc,WAAW,GAAG,KAAKF,WAAL,CAAiB,QAAjB,CAAlB;AACA,QAAIG,WAAW,GAAG,KAAKH,WAAL,CAAiB,QAAjB,CAAlB;AACA,QAAII,YAAY,GAAG,KAAKtB,GAAL,CAAS,cAAT,CAAnB;AACA,QAAIZ,IAAI,GAAGkB,KAAK,CAAClB,IAAjB;AACA,WAAOkC,YAAY,CAACC,gBAAb,CAA8BnC,IAA9B,EAAoC;AACzCG,MAAAA,UAAU,EAAE6B,WAD6B;AAEzC5B,MAAAA,QAAQ,EAAE6B;AAF+B,KAApC,CAAP;AAID,GATD;;AAWAvC,EAAAA,IAAI,CAACI,SAAL,CAAesC,YAAf,GAA8B,UAAU7B,IAAV,EAAgB;AAC5C,QAAIG,QAAQ,GAAGH,IAAI,GAAGhB,gBAAtB;AACA,QAAIkB,SAAS,GAAGrB,OAAO,CAACmB,IAAD,CAAP,GAAgBf,iBAAhC;AACA,QAAI6B,IAAI,GAAG,KAAKT,GAAL,CAASF,QAAT,CAAX,CAH4C,CAGb;;AAE/B,QAAIW,IAAJ,EAAU;AACR,UAAIgB,IAAI,GAAGhB,IAAI,CAACiB,OAAL,EAAX;AACA,aAAO;AACLC,QAAAA,CAAC,EAAEF,IAAI,CAACG,OADH;AAELC,QAAAA,CAAC,EAAEJ,IAAI,CAACK;AAFH,OAAP;AAID,KAX2C,CAW1C;;;AAGF,WAAO,KAAK9B,GAAL,CAASH,SAAT,CAAP;AACD,GAfD;;AAiBAf,EAAAA,IAAI,CAACI,SAAL,CAAe6C,IAAf,GAAsB,YAAY;AAChChD,IAAAA,MAAM,CAACG,SAAP,CAAiB6C,IAAjB,CAAsBC,IAAtB,CAA2B,IAA3B,EADgC,CACE;;;AAGlC,SAAKC,SAAL,CAAe,KAAKjC,GAAL,CAAS,QAAT,CAAf;AACA,SAAKkC,SAAL,CAAe,KAAKlC,GAAL,CAAS,QAAT,CAAf;AACD,GAND;;AAQAlB,EAAAA,IAAI,CAACI,SAAL,CAAeiD,WAAf,GAA6B,UAAU7B,KAAV,EAAiB;AAC5C,QAAI8B,IAAI,GAAG,IAAX;AACA,QAAI3C,UAAU,GAAG2C,IAAI,CAACpC,GAAL,CAAS,YAAT,CAAjB,CAF4C,CAEH;;AAEzC,QAAIqC,GAAG,GAAGtD,MAAM,CAACG,SAAP,CAAiBiD,WAAjB,CAA6BH,IAA7B,CAAkC,IAAlC,EAAwC1B,KAAxC,CAAV;;AAEA,QAAIb,UAAJ,EAAgB;AACd4C,MAAAA,GAAG,CAAC9C,UAAJ,GAAiB6C,IAAI,CAACZ,YAAL,CAAkB,QAAlB,CAAjB;AACAa,MAAAA,GAAG,CAAC7C,QAAJ,GAAe4C,IAAI,CAACZ,YAAL,CAAkB,QAAlB,CAAf;AACD,KAHD,MAGO;AACL,UAAIjB,aAAa,GAAG8B,GAAG,CAAC9B,aAAJ,IAAqB6B,IAAI,CAACjB,wBAAL,CAA8BkB,GAA9B,CAAzC;AACAA,MAAAA,GAAG,CAAC9C,UAAJ,GAAiB6C,IAAI,CAAC/B,YAAL,CAAkB,QAAlB,EAA4BC,KAA5B,EAAmCC,aAAnC,CAAjB;AACA8B,MAAAA,GAAG,CAAC7C,QAAJ,GAAe4C,IAAI,CAAC/B,YAAL,CAAkB,QAAlB,EAA4BC,KAA5B,EAAmCC,aAAnC,CAAf;AACD;;AAED8B,IAAAA,GAAG,CAAChD,UAAJ,GAAiB+C,IAAI,CAACpC,GAAL,CAAS,YAAT,CAAjB;AACAqC,IAAAA,GAAG,CAAC/C,UAAJ,GAAiB8C,IAAI,CAACpC,GAAL,CAAS,YAAT,CAAjB;AACA,WAAOqC,GAAP;AACD,GAlBD;AAmBA;AACF;AACA;;;AAGEvD,EAAAA,IAAI,CAACI,SAAL,CAAeoD,QAAf,GAA0B,YAAY;AACpC,QAAIC,GAAG,GAAG,KAAKvC,GAAL,CAAS,OAAT,CAAV;AACA,QAAIwC,UAAU,GAAG,KAAKxC,GAAL,CAAS,WAAWrB,gBAApB,CAAjB;AACA,QAAI8D,UAAU,GAAG,KAAKzC,GAAL,CAAS,WAAWrB,gBAApB,CAAjB;;AAEA,QAAI6D,UAAJ,EAAgB;AACd,aAAOD,GAAG,CAAC,WAAW5D,gBAAZ,CAAV;AACD,KAFD,MAEO;AACL4D,MAAAA,GAAG,CAAC9D,MAAJ,GAAa,KAAKuB,GAAL,CAAS,UAAUpB,iBAAnB,CAAb;AACD;;AAED,QAAI6D,UAAJ,EAAgB;AACd,aAAOF,GAAG,CAAC,WAAW5D,gBAAZ,CAAV;AACD,KAFD,MAEO;AACL4D,MAAAA,GAAG,CAAC7D,MAAJ,GAAa,KAAKsB,GAAL,CAAS,QAAQpB,iBAAjB,CAAb;AACD;;AAED,QAAI,CAACT,QAAQ,CAACoE,GAAG,CAAC9D,MAAL,CAAT,IAAyB,CAACL,aAAa,CAACmE,GAAG,CAAC9D,MAAL,CAA3C,EAAyD;AACvD8D,MAAAA,GAAG,CAAC9D,MAAJ,GAAa8D,GAAG,CAAC9D,MAAJ,CAAWiE,KAAX,EAAb;AACD;;AAED,QAAI,CAACvE,QAAQ,CAACoE,GAAG,CAAC7D,MAAL,CAAT,IAAyB,CAACN,aAAa,CAACmE,GAAG,CAAC7D,MAAL,CAA3C,EAAyD;AACvD6D,MAAAA,GAAG,CAAC7D,MAAJ,GAAa6D,GAAG,CAAC7D,MAAJ,CAAWgE,KAAX,EAAb;AACD;;AAED,WAAOH,GAAP;AACD,GA1BD;;AA4BAzD,EAAAA,IAAI,CAACI,SAAL,CAAe+C,SAAf,GAA2B,UAAUxD,MAAV,EAAkB;AAC3C,SAAKiB,MAAL,CAAY,QAAZ,EAAsBjB,MAAtB;AACA,SAAK0B,GAAL,CAAS,QAAT,EAAmB1B,MAAnB;AACD,GAHD;;AAKAK,EAAAA,IAAI,CAACI,SAAL,CAAegD,SAAf,GAA2B,UAAUxD,MAAV,EAAkB;AAC3C,SAAKgB,MAAL,CAAY,QAAZ,EAAsBhB,MAAtB;AACA,SAAKyB,GAAL,CAAS,QAAT,EAAmBzB,MAAnB;AACD,GAHD;;AAKAI,EAAAA,IAAI,CAACI,SAAL,CAAeyD,SAAf,GAA2B,YAAY;AACrC,WAAO,KAAK3C,GAAL,CAAS,QAAT,CAAP;AACD,GAFD;;AAIAlB,EAAAA,IAAI,CAACI,SAAL,CAAe0D,SAAf,GAA2B,YAAY;AACrC,WAAO,KAAK5C,GAAL,CAAS,QAAT,CAAP;AACD,GAFD;;AAIAlB,EAAAA,IAAI,CAACI,SAAL,CAAe2D,cAAf,GAAgC,YAAY;AAC1C,WAAO,KAAP;AACD,GAFD;AAGA;AACF;AACA;AACA;;;AAGE/D,EAAAA,IAAI,CAACI,SAAL,CAAe4D,MAAf,GAAwB,UAAUT,GAAV,EAAeU,QAAf,EAAyB;AAC/C,QAAIA,QAAQ,KAAK,KAAK,CAAtB,EAAyB;AACvBA,MAAAA,QAAQ,GAAG,KAAX;AACD;;AAED,QAAIzC,KAAK,GAAG,KAAKN,GAAL,CAAS,OAAT,CAAZ;AACA,QAAIgD,UAAU,GAAG1C,KAAK,CAAC2C,OAAvB;AACA,QAAIC,UAAU,GAAGb,GAAG,CAACY,OAArB;AACA,QAAID,UAAU,KAAKE,UAAf,IAA6BA,UAAU,KAAKC,SAAhD,EAA2D,KAAKC,gBAAL,CAAsBF,UAAtB;AAC3D,QAAIG,MAAM,GAAG,KAAKrD,GAAL,CAAS,QAAT,CAAb;;AAEA,QAAIqC,GAAG,CAACiB,WAAR,EAAqB;AACnB;AACA,UAAIA,WAAW,GAAGjB,GAAG,CAACiB,WAAtB;AACAhF,MAAAA,GAAG,CAAC+E,MAAD,EAASC,WAAT,CAAH;AACA,aAAOjB,GAAG,CAACiB,WAAX;AACD;;AAEDC,IAAAA,MAAM,CAACC,MAAP,CAAclD,KAAd,EAAqB+B,GAArB;AACA,SAAKoB,WAAL;AACA,SAAKC,WAAL;AACA,SAAKC,UAAL;AACD,GAtBD;;AAwBA7E,EAAAA,IAAI,CAACI,SAAL,CAAe0E,OAAf,GAAyB,YAAY;AACnC,QAAIpB,UAAU,GAAG,KAAKxC,GAAL,CAAS,WAAWrB,gBAApB,CAAjB;AACA,QAAI8D,UAAU,GAAG,KAAKzC,GAAL,CAAS,WAAWrB,gBAApB,CAAjB;;AAEA,QAAI6D,UAAU,IAAI,CAACA,UAAU,CAACvC,SAA9B,EAAyC;AACvCuC,MAAAA,UAAU,CAACtC,UAAX,CAAsB,IAAtB;AACD;;AAED,QAAIuC,UAAU,IAAI,CAACA,UAAU,CAACxC,SAA9B,EAAyC;AACvCwC,MAAAA,UAAU,CAACvC,UAAX,CAAsB,IAAtB;AACD;;AAEDnB,IAAAA,MAAM,CAACG,SAAP,CAAiB0E,OAAjB,CAAyB5B,IAAzB,CAA8B,IAA9B;AACD,GAbD;;AAeA,SAAOlD,IAAP;AACD,CA5QD,CA4QEP,IA5QF,CAFA;;AAgRA,eAAeO,IAAf","sourcesContent":["import { __extends } from \"tslib\";\r\nimport { isString, isPlainObject, isNil, mix } from '@antv/util';\r\nimport Item from './item';\r\nvar END_MAP = {\r\n  source: 'start',\r\n  target: 'end'\r\n};\r\nvar ITEM_NAME_SUFFIX = 'Node'; // 端点的后缀，如 sourceNode, targetNode\r\n\r\nvar POINT_NAME_SUFFIX = 'Point'; // 起点或者结束点的后缀，如 startPoint, endPoint\r\n\r\nvar ANCHOR_NAME_SUFFIX = 'Anchor';\r\n\r\nvar Edge =\r\n/** @class */\r\nfunction (_super) {\r\n  __extends(Edge, _super);\r\n\r\n  function Edge() {\r\n    return _super !== null && _super.apply(this, arguments) || this;\r\n  }\r\n\r\n  Edge.prototype.getDefaultCfg = function () {\r\n    return {\r\n      type: 'edge',\r\n      sourceNode: null,\r\n      targetNode: null,\r\n      startPoint: null,\r\n      endPoint: null,\r\n      linkCenter: false\r\n    };\r\n  };\r\n\r\n  Edge.prototype.setEnd = function (name, value) {\r\n    var pointName = END_MAP[name] + POINT_NAME_SUFFIX;\r\n    var itemName = name + ITEM_NAME_SUFFIX;\r\n    var preItem = this.get(itemName);\r\n\r\n    if (preItem && !preItem.destroyed) {\r\n      // 如果之前存在节点，则移除掉边\r\n      preItem.removeEdge(this);\r\n    }\r\n\r\n    if (isPlainObject(value)) {\r\n      // 如果设置成具体的点，则清理节点\r\n      this.set(pointName, value);\r\n      this.set(itemName, null);\r\n    } else if (value) {\r\n      value.addEdge(this);\r\n      this.set(itemName, value);\r\n      this.set(pointName, null);\r\n    }\r\n  };\r\n  /**\r\n   * 获取连接点的坐标\r\n   * @param name source | target\r\n   * @param model 边的数据模型\r\n   * @param controlPoints 控制点\r\n   */\r\n\r\n\r\n  Edge.prototype.getLinkPoint = function (name, model, controlPoints) {\r\n    var pointName = END_MAP[name] + POINT_NAME_SUFFIX;\r\n    var itemName = name + ITEM_NAME_SUFFIX;\r\n    var point = this.get(pointName);\r\n\r\n    if (!point) {\r\n      var item = this.get(itemName);\r\n      var anchorName = name + ANCHOR_NAME_SUFFIX;\r\n      var prePoint = this.getPrePoint(name, controlPoints);\r\n      var anchorIndex = model[anchorName];\r\n\r\n      if (!isNil(anchorIndex)) {\r\n        // 如果有锚点，则使用锚点索引获取连接点\r\n        point = item.getLinkPointByAnchor(anchorIndex);\r\n      } // 如果锚点没有对应的点或者没有锚点，则直接计算连接点\r\n\r\n\r\n      point = point || item.getLinkPoint(prePoint);\r\n\r\n      if (!isNil(point.index)) {\r\n        this.set(name + \"AnchorIndex\", point.index);\r\n      }\r\n    }\r\n\r\n    return point;\r\n  };\r\n  /**\r\n   * 获取同端点进行连接的点，计算交汇点\r\n   * @param name\r\n   * @param controlPoints\r\n   */\r\n\r\n\r\n  Edge.prototype.getPrePoint = function (name, controlPoints) {\r\n    if (controlPoints && controlPoints.length) {\r\n      var index = name === 'source' ? 0 : controlPoints.length - 1;\r\n      return controlPoints[index];\r\n    }\r\n\r\n    var oppositeName = name === 'source' ? 'target' : 'source'; // 取另一个节点的位置\r\n\r\n    return this.getEndPoint(oppositeName);\r\n  };\r\n  /**\r\n   * 获取端点的位置\r\n   * @param name\r\n   */\r\n\r\n\r\n  Edge.prototype.getEndPoint = function (name) {\r\n    var itemName = name + ITEM_NAME_SUFFIX;\r\n    var pointName = END_MAP[name] + POINT_NAME_SUFFIX;\r\n    var item = this.get(itemName); // 如果有端点，直接使用 model\r\n\r\n    if (item) {\r\n      return item.get('model');\r\n    } // 否则直接使用点\r\n\r\n\r\n    return this.get(pointName);\r\n  };\r\n  /**\r\n   * 通过端点的中心获取控制点\r\n   * @param model\r\n   */\r\n\r\n\r\n  Edge.prototype.getControlPointsByCenter = function (model) {\r\n    var sourcePoint = this.getEndPoint('source');\r\n    var targetPoint = this.getEndPoint('target');\r\n    var shapeFactory = this.get('shapeFactory');\r\n    var type = model.type;\r\n    return shapeFactory.getControlPoints(type, {\r\n      startPoint: sourcePoint,\r\n      endPoint: targetPoint\r\n    });\r\n  };\r\n\r\n  Edge.prototype.getEndCenter = function (name) {\r\n    var itemName = name + ITEM_NAME_SUFFIX;\r\n    var pointName = END_MAP[name] + POINT_NAME_SUFFIX;\r\n    var item = this.get(itemName); // 如果有端点，直接使用 model\r\n\r\n    if (item) {\r\n      var bbox = item.getBBox();\r\n      return {\r\n        x: bbox.centerX,\r\n        y: bbox.centerY\r\n      };\r\n    } // 否则直接使用点\r\n\r\n\r\n    return this.get(pointName);\r\n  };\r\n\r\n  Edge.prototype.init = function () {\r\n    _super.prototype.init.call(this); // 初始化两个端点\r\n\r\n\r\n    this.setSource(this.get('source'));\r\n    this.setTarget(this.get('target'));\r\n  };\r\n\r\n  Edge.prototype.getShapeCfg = function (model) {\r\n    var self = this;\r\n    var linkCenter = self.get('linkCenter'); // 如果连接到中心，忽视锚点、忽视控制点\r\n\r\n    var cfg = _super.prototype.getShapeCfg.call(this, model);\r\n\r\n    if (linkCenter) {\r\n      cfg.startPoint = self.getEndCenter('source');\r\n      cfg.endPoint = self.getEndCenter('target');\r\n    } else {\r\n      var controlPoints = cfg.controlPoints || self.getControlPointsByCenter(cfg);\r\n      cfg.startPoint = self.getLinkPoint('source', model, controlPoints);\r\n      cfg.endPoint = self.getLinkPoint('target', model, controlPoints);\r\n    }\r\n\r\n    cfg.sourceNode = self.get('sourceNode');\r\n    cfg.targetNode = self.get('targetNode');\r\n    return cfg;\r\n  };\r\n  /**\r\n   * 获取边的数据模型\r\n   */\r\n\r\n\r\n  Edge.prototype.getModel = function () {\r\n    var out = this.get('model');\r\n    var sourceItem = this.get(\"source\" + ITEM_NAME_SUFFIX);\r\n    var targetItem = this.get(\"target\" + ITEM_NAME_SUFFIX);\r\n\r\n    if (sourceItem) {\r\n      delete out[\"source\" + ITEM_NAME_SUFFIX];\r\n    } else {\r\n      out.source = this.get(\"start\" + POINT_NAME_SUFFIX);\r\n    }\r\n\r\n    if (targetItem) {\r\n      delete out[\"target\" + ITEM_NAME_SUFFIX];\r\n    } else {\r\n      out.target = this.get(\"end\" + POINT_NAME_SUFFIX);\r\n    }\r\n\r\n    if (!isString(out.source) && !isPlainObject(out.source)) {\r\n      out.source = out.source.getID();\r\n    }\r\n\r\n    if (!isString(out.target) && !isPlainObject(out.target)) {\r\n      out.target = out.target.getID();\r\n    }\r\n\r\n    return out;\r\n  };\r\n\r\n  Edge.prototype.setSource = function (source) {\r\n    this.setEnd('source', source);\r\n    this.set('source', source);\r\n  };\r\n\r\n  Edge.prototype.setTarget = function (target) {\r\n    this.setEnd('target', target);\r\n    this.set('target', target);\r\n  };\r\n\r\n  Edge.prototype.getSource = function () {\r\n    return this.get('source');\r\n  };\r\n\r\n  Edge.prototype.getTarget = function () {\r\n    return this.get('target');\r\n  };\r\n\r\n  Edge.prototype.updatePosition = function () {\r\n    return false;\r\n  };\r\n  /**\r\n   * 边不需要重计算容器位置，直接重新计算 path 位置\r\n   * @param {object} cfg 待更新数据\r\n   */\r\n\r\n\r\n  Edge.prototype.update = function (cfg, onlyMove) {\r\n    if (onlyMove === void 0) {\r\n      onlyMove = false;\r\n    }\r\n\r\n    var model = this.get('model');\r\n    var oriVisible = model.visible;\r\n    var cfgVisible = cfg.visible;\r\n    if (oriVisible !== cfgVisible && cfgVisible !== undefined) this.changeVisibility(cfgVisible);\r\n    var styles = this.get('styles');\r\n\r\n    if (cfg.stateStyles) {\r\n      // 更新 item 时更新 this.get('styles') 中的值\r\n      var stateStyles = cfg.stateStyles;\r\n      mix(styles, stateStyles);\r\n      delete cfg.stateStyles;\r\n    }\r\n\r\n    Object.assign(model, cfg);\r\n    this.updateShape();\r\n    this.afterUpdate();\r\n    this.clearCache();\r\n  };\r\n\r\n  Edge.prototype.destroy = function () {\r\n    var sourceItem = this.get(\"source\" + ITEM_NAME_SUFFIX);\r\n    var targetItem = this.get(\"target\" + ITEM_NAME_SUFFIX);\r\n\r\n    if (sourceItem && !sourceItem.destroyed) {\r\n      sourceItem.removeEdge(this);\r\n    }\r\n\r\n    if (targetItem && !targetItem.destroyed) {\r\n      targetItem.removeEdge(this);\r\n    }\r\n\r\n    _super.prototype.destroy.call(this);\r\n  };\r\n\r\n  return Edge;\r\n}(Item);\r\n\r\nexport default Edge;"]},"metadata":{},"sourceType":"module"}