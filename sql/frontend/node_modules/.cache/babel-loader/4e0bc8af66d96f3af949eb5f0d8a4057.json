{"ast":null,"code":"import { __extends } from \"tslib\";\nimport { each, isDate, isNil, isNumber, isString } from '@antv/util';\nimport { timeFormat, toTimeStamp } from '../util/time';\nimport Linear from './linear';\n/**\r\n * 时间度量\r\n * @class\r\n */\n\nvar Time =\n/** @class */\nfunction (_super) {\n  __extends(Time, _super);\n\n  function Time() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.type = 'time';\n    return _this;\n  }\n  /**\r\n   * @override\r\n   */\n\n\n  Time.prototype.getText = function (value, index) {\n    var numberValue = this.translate(value);\n    var formatter = this.formatter;\n    return formatter ? formatter(numberValue, index) : timeFormat(numberValue, this.mask);\n  };\n  /**\r\n   * @override\r\n   */\n\n\n  Time.prototype.scale = function (value) {\n    var v = value;\n\n    if (isString(v) || isDate(v)) {\n      v = this.translate(v);\n    }\n\n    return _super.prototype.scale.call(this, v);\n  };\n  /**\r\n   * 将时间转换成数字\r\n   * @override\r\n   */\n\n\n  Time.prototype.translate = function (v) {\n    return toTimeStamp(v);\n  };\n\n  Time.prototype.initCfg = function () {\n    this.tickMethod = 'time-pretty';\n    this.mask = 'YYYY-MM-DD';\n    this.tickCount = 7;\n    this.nice = false;\n  };\n\n  Time.prototype.setDomain = function () {\n    var values = this.values; // 是否设置了 min, max，而不是直接取 this.min, this.max\n\n    var minConfig = this.getConfig('min');\n    var maxConfig = this.getConfig('max'); // 如果设置了 min,max 则转换成时间戳\n\n    if (!isNil(minConfig) || !isNumber(minConfig)) {\n      this.min = this.translate(this.min);\n    }\n\n    if (!isNil(maxConfig) || !isNumber(maxConfig)) {\n      this.max = this.translate(this.max);\n    } // 没有设置 min, max 时\n\n\n    if (values && values.length) {\n      // 重新计算最大最小值\n      var timeStamps_1 = [];\n      var min_1 = Infinity; // 最小值\n\n      var secondMin_1 = min_1; // 次小值\n\n      var max_1 = 0; // 使用一个循环，计算min,max,secondMin\n\n      each(values, function (v) {\n        var timeStamp = toTimeStamp(v);\n\n        if (isNaN(timeStamp)) {\n          throw new TypeError(\"Invalid Time: \" + v + \" in time scale!\");\n        }\n\n        if (min_1 > timeStamp) {\n          secondMin_1 = min_1;\n          min_1 = timeStamp;\n        } else if (secondMin_1 > timeStamp) {\n          secondMin_1 = timeStamp;\n        }\n\n        if (max_1 < timeStamp) {\n          max_1 = timeStamp;\n        }\n\n        timeStamps_1.push(timeStamp);\n      }); // 存在多个值时，设置最小间距\n\n      if (values.length > 1) {\n        this.minTickInterval = secondMin_1 - min_1;\n      }\n\n      if (isNil(minConfig)) {\n        this.min = min_1;\n      }\n\n      if (isNil(maxConfig)) {\n        this.max = max_1;\n      }\n    }\n  };\n\n  return Time;\n}(Linear);\n\nexport default Time;","map":{"version":3,"sources":["../../src/continuous/time.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { __extends } from \"tslib\";\r\nimport { each, isDate, isNil, isNumber, isString } from '@antv/util';\r\nimport { timeFormat, toTimeStamp } from '../util/time';\r\nimport Linear from './linear';\r\n/**\r\n * 时间度量\r\n * @class\r\n */\r\nvar Time = /** @class */ (function (_super) {\r\n    __extends(Time, _super);\r\n    function Time() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.type = 'time';\r\n        return _this;\r\n    }\r\n    /**\r\n     * @override\r\n     */\r\n    Time.prototype.getText = function (value, index) {\r\n        var numberValue = this.translate(value);\r\n        var formatter = this.formatter;\r\n        return formatter ? formatter(numberValue, index) : timeFormat(numberValue, this.mask);\r\n    };\r\n    /**\r\n     * @override\r\n     */\r\n    Time.prototype.scale = function (value) {\r\n        var v = value;\r\n        if (isString(v) || isDate(v)) {\r\n            v = this.translate(v);\r\n        }\r\n        return _super.prototype.scale.call(this, v);\r\n    };\r\n    /**\r\n     * 将时间转换成数字\r\n     * @override\r\n     */\r\n    Time.prototype.translate = function (v) {\r\n        return toTimeStamp(v);\r\n    };\r\n    Time.prototype.initCfg = function () {\r\n        this.tickMethod = 'time-pretty';\r\n        this.mask = 'YYYY-MM-DD';\r\n        this.tickCount = 7;\r\n        this.nice = false;\r\n    };\r\n    Time.prototype.setDomain = function () {\r\n        var values = this.values;\r\n        // 是否设置了 min, max，而不是直接取 this.min, this.max\r\n        var minConfig = this.getConfig('min');\r\n        var maxConfig = this.getConfig('max');\r\n        // 如果设置了 min,max 则转换成时间戳\r\n        if (!isNil(minConfig) || !isNumber(minConfig)) {\r\n            this.min = this.translate(this.min);\r\n        }\r\n        if (!isNil(maxConfig) || !isNumber(maxConfig)) {\r\n            this.max = this.translate(this.max);\r\n        }\r\n        // 没有设置 min, max 时\r\n        if (values && values.length) {\r\n            // 重新计算最大最小值\r\n            var timeStamps_1 = [];\r\n            var min_1 = Infinity; // 最小值\r\n            var secondMin_1 = min_1; // 次小值\r\n            var max_1 = 0;\r\n            // 使用一个循环，计算min,max,secondMin\r\n            each(values, function (v) {\r\n                var timeStamp = toTimeStamp(v);\r\n                if (isNaN(timeStamp)) {\r\n                    throw new TypeError(\"Invalid Time: \" + v + \" in time scale!\");\r\n                }\r\n                if (min_1 > timeStamp) {\r\n                    secondMin_1 = min_1;\r\n                    min_1 = timeStamp;\r\n                }\r\n                else if (secondMin_1 > timeStamp) {\r\n                    secondMin_1 = timeStamp;\r\n                }\r\n                if (max_1 < timeStamp) {\r\n                    max_1 = timeStamp;\r\n                }\r\n                timeStamps_1.push(timeStamp);\r\n            });\r\n            // 存在多个值时，设置最小间距\r\n            if (values.length > 1) {\r\n                this.minTickInterval = secondMin_1 - min_1;\r\n            }\r\n            if (isNil(minConfig)) {\r\n                this.min = min_1;\r\n            }\r\n            if (isNil(maxConfig)) {\r\n                this.max = max_1;\r\n            }\r\n        }\r\n    };\r\n    return Time;\r\n}(Linear));\r\nexport default Time;\r\n//# sourceMappingURL=time.js.map"]},"metadata":{},"sourceType":"module"}