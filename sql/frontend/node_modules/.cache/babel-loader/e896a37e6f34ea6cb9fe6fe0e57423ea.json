{"ast":null,"code":"import { __assign } from \"tslib\";\nimport { isNumber, isString } from '@antv/util';\nimport { formatPadding } from '../../util/base';\nimport { applyMatrix, invertMatrix } from '../../util/math';\n\nvar ViewController =\n/** @class */\nfunction () {\n  function ViewController(graph) {\n    this.destroyed = false;\n    this.graph = graph;\n    this.destroyed = false;\n  } // get view center coordinate\n\n\n  ViewController.prototype.getViewCenter = function () {\n    var padding = this.getFormatPadding();\n    var graph = this.graph;\n    var width = this.graph.get('width');\n    var height = graph.get('height');\n    return {\n      x: (width - padding[1] - padding[3]) / 2 + padding[3],\n      y: (height - padding[0] - padding[2]) / 2 + padding[0]\n    };\n  };\n\n  ViewController.prototype.fitCenter = function () {\n    var graph = this.graph;\n    var group = graph.get('group');\n    group.resetMatrix();\n    var bbox = group.getCanvasBBox();\n    if (bbox.width === 0 || bbox.height === 0) return;\n    var viewCenter = this.getViewCenter();\n    var groupCenter = {\n      x: bbox.x + bbox.width / 2,\n      y: bbox.y + bbox.height / 2\n    };\n    graph.translate(viewCenter.x - groupCenter.x, viewCenter.y - groupCenter.y);\n  }; // fit view graph\n\n\n  ViewController.prototype.fitView = function () {\n    var graph = this.graph;\n    var padding = this.getFormatPadding();\n    var width = graph.get('width');\n    var height = graph.get('height');\n    var group = graph.get('group');\n    group.resetMatrix();\n    var bbox = group.getCanvasBBox();\n    if (bbox.width === 0 || bbox.height === 0) return;\n    var viewCenter = this.getViewCenter();\n    var groupCenter = {\n      x: bbox.x + bbox.width / 2,\n      y: bbox.y + bbox.height / 2\n    };\n    graph.translate(viewCenter.x - groupCenter.x, viewCenter.y - groupCenter.y);\n    var w = (width - padding[1] - padding[3]) / bbox.width;\n    var h = (height - padding[0] - padding[2]) / bbox.height;\n    var ratio = w;\n\n    if (w > h) {\n      ratio = h;\n    }\n\n    graph.zoom(ratio, viewCenter);\n  };\n\n  ViewController.prototype.getFormatPadding = function () {\n    var padding = this.graph.get('fitViewPadding');\n    return formatPadding(padding);\n  };\n\n  ViewController.prototype.focusPoint = function (point, animate, animateCfg) {\n    var _this = this;\n\n    var viewCenter = this.getViewCenter();\n    var modelCenter = this.getPointByCanvas(viewCenter.x, viewCenter.y);\n    var viewportMatrix = this.graph.get('group').getMatrix();\n    if (!viewportMatrix) viewportMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n\n    if (animate) {\n      var dx_1 = (modelCenter.x - point.x) * viewportMatrix[0];\n      var dy_1 = (modelCenter.y - point.y) * viewportMatrix[4];\n      var lastX_1 = 0;\n      var lastY_1 = 0;\n      var newX_1 = 0;\n      var newY_1 = 0; // 动画每次平移一点，直到目标位置\n\n      this.graph.get('canvas').animate(function (ratio) {\n        newX_1 = dx_1 * ratio;\n        newY_1 = dy_1 * ratio;\n\n        _this.graph.translate(newX_1 - lastX_1, newY_1 - lastY_1);\n\n        lastX_1 = newX_1;\n        lastY_1 = newY_1;\n      }, __assign({}, animateCfg));\n    } else {\n      this.graph.translate((modelCenter.x - point.x) * viewportMatrix[0], (modelCenter.y - point.y) * viewportMatrix[4]);\n    }\n  };\n  /**\r\n   * 将 Canvas 坐标转成视口坐标\r\n   * @param canvasX canvas x 坐标\r\n   * @param canvasY canvas y 坐标\r\n   */\n\n\n  ViewController.prototype.getPointByCanvas = function (canvasX, canvasY) {\n    var viewportMatrix = this.graph.get('group').getMatrix();\n\n    if (!viewportMatrix) {\n      viewportMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n    }\n\n    var point = invertMatrix({\n      x: canvasX,\n      y: canvasY\n    }, viewportMatrix);\n    return point;\n  };\n  /**\r\n   * 将页面坐标转成视口坐标\r\n   * @param clientX 页面 x 坐标\r\n   * @param clientY 页面 y 坐标\r\n   */\n\n\n  ViewController.prototype.getPointByClient = function (clientX, clientY) {\n    var canvas = this.graph.get('canvas');\n    var canvasPoint = canvas.getPointByClient(clientX, clientY);\n    return this.getPointByCanvas(canvasPoint.x, canvasPoint.y);\n  };\n  /**\r\n   * 将视口坐标转成页面坐标\r\n   * @param x 视口 x 坐标\r\n   * @param y 视口 y 坐标\r\n   */\n\n\n  ViewController.prototype.getClientByPoint = function (x, y) {\n    var canvas = this.graph.get('canvas');\n    var canvasPoint = this.getCanvasByPoint(x, y);\n    var point = canvas.getClientByPoint(canvasPoint.x, canvasPoint.y);\n    return {\n      x: point.x,\n      y: point.y\n    };\n  };\n  /**\r\n   * 将视口坐标转成 Canvas 坐标\r\n   * @param x 视口 x 坐标\r\n   * @param y 视口 y 坐标\r\n   */\n\n\n  ViewController.prototype.getCanvasByPoint = function (x, y) {\n    var viewportMatrix = this.graph.get('group').getMatrix();\n\n    if (!viewportMatrix) {\n      viewportMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n    }\n\n    return applyMatrix({\n      x: x,\n      y: y\n    }, viewportMatrix);\n  };\n  /**\r\n   * 将元素移动到画布中心\r\n   * @param item Item 实例或 id\r\n   * @param {boolean} animate 是否带有动画地移动\r\n   * @param {GraphAnimateConfig} animateCfg 若带有动画，动画的配置项\r\n   */\n\n\n  ViewController.prototype.focus = function (item, animate, animateCfg) {\n    if (isString(item)) {\n      item = this.graph.findById(item);\n    }\n\n    if (item) {\n      var x = 0,\n          y = 0;\n\n      if (item.getType && item.getType() === 'edge') {\n        var sourceMatrix = item.getSource().get('group').getMatrix();\n        var targetMatrix = item.getTarget().get('group').getMatrix();\n\n        if (sourceMatrix && targetMatrix) {\n          x = (sourceMatrix[6] + targetMatrix[6]) / 2;\n          y = (sourceMatrix[7] + targetMatrix[7]) / 2;\n        } else if (sourceMatrix || targetMatrix) {\n          x = sourceMatrix ? sourceMatrix[6] : targetMatrix[6];\n          y = sourceMatrix ? sourceMatrix[7] : targetMatrix[7];\n        }\n      } else {\n        var group = item.get('group');\n        var matrix = group.getMatrix();\n        if (!matrix) matrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n        x = matrix[6];\n        y = matrix[7];\n      } // 用实际位置而不是model中的x,y,防止由于拖拽等的交互导致model的x,y并不是当前的x,y\n\n\n      this.focusPoint({\n        x: x,\n        y: y\n      }, animate, animateCfg);\n    }\n  };\n  /**\r\n   * 改变 canvas 画布的宽度和高度\r\n   * @param width canvas 宽度\r\n   * @param height canvas 高度\r\n   */\n\n\n  ViewController.prototype.changeSize = function (width, height) {\n    var graph = this.graph;\n\n    if (!isNumber(width) || !isNumber(height)) {\n      throw Error('invalid canvas width & height, please make sure width & height type is number');\n    }\n\n    graph.set({\n      width: width,\n      height: height\n    });\n    var canvas = graph.get('canvas');\n    canvas.changeSize(width, height); // change the size of grid plugin if it exists on graph\n\n    var plugins = graph.get('plugins');\n    plugins.forEach(function (plugin) {\n      if (plugin.get('gridContainer')) {\n        // 网格定位信息初始化\n        plugin.positionInit();\n      }\n    });\n  };\n\n  ViewController.prototype.destroy = function () {\n    this.graph = null;\n    this.destroyed = false;\n  };\n\n  return ViewController;\n}();\n\nexport default ViewController;","map":{"version":3,"sources":["E:/sqlindex2/sql/frontend/node_modules/@antv/g6-core/es/graph/controller/view.js"],"names":["__assign","isNumber","isString","formatPadding","applyMatrix","invertMatrix","ViewController","graph","destroyed","prototype","getViewCenter","padding","getFormatPadding","width","get","height","x","y","fitCenter","group","resetMatrix","bbox","getCanvasBBox","viewCenter","groupCenter","translate","fitView","w","h","ratio","zoom","focusPoint","point","animate","animateCfg","_this","modelCenter","getPointByCanvas","viewportMatrix","getMatrix","dx_1","dy_1","lastX_1","lastY_1","newX_1","newY_1","canvasX","canvasY","getPointByClient","clientX","clientY","canvas","canvasPoint","getClientByPoint","getCanvasByPoint","focus","item","findById","getType","sourceMatrix","getSource","targetMatrix","getTarget","matrix","changeSize","Error","set","plugins","forEach","plugin","positionInit","destroy"],"mappings":"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","sourcesContent":["import { __assign } from \"tslib\";\r\nimport { isNumber, isString } from '@antv/util';\r\nimport { formatPadding } from '../../util/base';\r\nimport { applyMatrix, invertMatrix } from '../../util/math';\r\n\r\nvar ViewController =\r\n/** @class */\r\nfunction () {\r\n  function ViewController(graph) {\r\n    this.destroyed = false;\r\n    this.graph = graph;\r\n    this.destroyed = false;\r\n  } // get view center coordinate\r\n\r\n\r\n  ViewController.prototype.getViewCenter = function () {\r\n    var padding = this.getFormatPadding();\r\n    var graph = this.graph;\r\n    var width = this.graph.get('width');\r\n    var height = graph.get('height');\r\n    return {\r\n      x: (width - padding[1] - padding[3]) / 2 + padding[3],\r\n      y: (height - padding[0] - padding[2]) / 2 + padding[0]\r\n    };\r\n  };\r\n\r\n  ViewController.prototype.fitCenter = function () {\r\n    var graph = this.graph;\r\n    var group = graph.get('group');\r\n    group.resetMatrix();\r\n    var bbox = group.getCanvasBBox();\r\n    if (bbox.width === 0 || bbox.height === 0) return;\r\n    var viewCenter = this.getViewCenter();\r\n    var groupCenter = {\r\n      x: bbox.x + bbox.width / 2,\r\n      y: bbox.y + bbox.height / 2\r\n    };\r\n    graph.translate(viewCenter.x - groupCenter.x, viewCenter.y - groupCenter.y);\r\n  }; // fit view graph\r\n\r\n\r\n  ViewController.prototype.fitView = function () {\r\n    var graph = this.graph;\r\n    var padding = this.getFormatPadding();\r\n    var width = graph.get('width');\r\n    var height = graph.get('height');\r\n    var group = graph.get('group');\r\n    group.resetMatrix();\r\n    var bbox = group.getCanvasBBox();\r\n    if (bbox.width === 0 || bbox.height === 0) return;\r\n    var viewCenter = this.getViewCenter();\r\n    var groupCenter = {\r\n      x: bbox.x + bbox.width / 2,\r\n      y: bbox.y + bbox.height / 2\r\n    };\r\n    graph.translate(viewCenter.x - groupCenter.x, viewCenter.y - groupCenter.y);\r\n    var w = (width - padding[1] - padding[3]) / bbox.width;\r\n    var h = (height - padding[0] - padding[2]) / bbox.height;\r\n    var ratio = w;\r\n\r\n    if (w > h) {\r\n      ratio = h;\r\n    }\r\n\r\n    graph.zoom(ratio, viewCenter);\r\n  };\r\n\r\n  ViewController.prototype.getFormatPadding = function () {\r\n    var padding = this.graph.get('fitViewPadding');\r\n    return formatPadding(padding);\r\n  };\r\n\r\n  ViewController.prototype.focusPoint = function (point, animate, animateCfg) {\r\n    var _this = this;\r\n\r\n    var viewCenter = this.getViewCenter();\r\n    var modelCenter = this.getPointByCanvas(viewCenter.x, viewCenter.y);\r\n    var viewportMatrix = this.graph.get('group').getMatrix();\r\n    if (!viewportMatrix) viewportMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\r\n\r\n    if (animate) {\r\n      var dx_1 = (modelCenter.x - point.x) * viewportMatrix[0];\r\n      var dy_1 = (modelCenter.y - point.y) * viewportMatrix[4];\r\n      var lastX_1 = 0;\r\n      var lastY_1 = 0;\r\n      var newX_1 = 0;\r\n      var newY_1 = 0; // 动画每次平移一点，直到目标位置\r\n\r\n      this.graph.get('canvas').animate(function (ratio) {\r\n        newX_1 = dx_1 * ratio;\r\n        newY_1 = dy_1 * ratio;\r\n\r\n        _this.graph.translate(newX_1 - lastX_1, newY_1 - lastY_1);\r\n\r\n        lastX_1 = newX_1;\r\n        lastY_1 = newY_1;\r\n      }, __assign({}, animateCfg));\r\n    } else {\r\n      this.graph.translate((modelCenter.x - point.x) * viewportMatrix[0], (modelCenter.y - point.y) * viewportMatrix[4]);\r\n    }\r\n  };\r\n  /**\r\n   * 将 Canvas 坐标转成视口坐标\r\n   * @param canvasX canvas x 坐标\r\n   * @param canvasY canvas y 坐标\r\n   */\r\n\r\n\r\n  ViewController.prototype.getPointByCanvas = function (canvasX, canvasY) {\r\n    var viewportMatrix = this.graph.get('group').getMatrix();\r\n\r\n    if (!viewportMatrix) {\r\n      viewportMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\r\n    }\r\n\r\n    var point = invertMatrix({\r\n      x: canvasX,\r\n      y: canvasY\r\n    }, viewportMatrix);\r\n    return point;\r\n  };\r\n  /**\r\n   * 将页面坐标转成视口坐标\r\n   * @param clientX 页面 x 坐标\r\n   * @param clientY 页面 y 坐标\r\n   */\r\n\r\n\r\n  ViewController.prototype.getPointByClient = function (clientX, clientY) {\r\n    var canvas = this.graph.get('canvas');\r\n    var canvasPoint = canvas.getPointByClient(clientX, clientY);\r\n    return this.getPointByCanvas(canvasPoint.x, canvasPoint.y);\r\n  };\r\n  /**\r\n   * 将视口坐标转成页面坐标\r\n   * @param x 视口 x 坐标\r\n   * @param y 视口 y 坐标\r\n   */\r\n\r\n\r\n  ViewController.prototype.getClientByPoint = function (x, y) {\r\n    var canvas = this.graph.get('canvas');\r\n    var canvasPoint = this.getCanvasByPoint(x, y);\r\n    var point = canvas.getClientByPoint(canvasPoint.x, canvasPoint.y);\r\n    return {\r\n      x: point.x,\r\n      y: point.y\r\n    };\r\n  };\r\n  /**\r\n   * 将视口坐标转成 Canvas 坐标\r\n   * @param x 视口 x 坐标\r\n   * @param y 视口 y 坐标\r\n   */\r\n\r\n\r\n  ViewController.prototype.getCanvasByPoint = function (x, y) {\r\n    var viewportMatrix = this.graph.get('group').getMatrix();\r\n\r\n    if (!viewportMatrix) {\r\n      viewportMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\r\n    }\r\n\r\n    return applyMatrix({\r\n      x: x,\r\n      y: y\r\n    }, viewportMatrix);\r\n  };\r\n  /**\r\n   * 将元素移动到画布中心\r\n   * @param item Item 实例或 id\r\n   * @param {boolean} animate 是否带有动画地移动\r\n   * @param {GraphAnimateConfig} animateCfg 若带有动画，动画的配置项\r\n   */\r\n\r\n\r\n  ViewController.prototype.focus = function (item, animate, animateCfg) {\r\n    if (isString(item)) {\r\n      item = this.graph.findById(item);\r\n    }\r\n\r\n    if (item) {\r\n      var x = 0,\r\n          y = 0;\r\n\r\n      if (item.getType && item.getType() === 'edge') {\r\n        var sourceMatrix = item.getSource().get('group').getMatrix();\r\n        var targetMatrix = item.getTarget().get('group').getMatrix();\r\n\r\n        if (sourceMatrix && targetMatrix) {\r\n          x = (sourceMatrix[6] + targetMatrix[6]) / 2;\r\n          y = (sourceMatrix[7] + targetMatrix[7]) / 2;\r\n        } else if (sourceMatrix || targetMatrix) {\r\n          x = sourceMatrix ? sourceMatrix[6] : targetMatrix[6];\r\n          y = sourceMatrix ? sourceMatrix[7] : targetMatrix[7];\r\n        }\r\n      } else {\r\n        var group = item.get('group');\r\n        var matrix = group.getMatrix();\r\n        if (!matrix) matrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\r\n        x = matrix[6];\r\n        y = matrix[7];\r\n      } // 用实际位置而不是model中的x,y,防止由于拖拽等的交互导致model的x,y并不是当前的x,y\r\n\r\n\r\n      this.focusPoint({\r\n        x: x,\r\n        y: y\r\n      }, animate, animateCfg);\r\n    }\r\n  };\r\n  /**\r\n   * 改变 canvas 画布的宽度和高度\r\n   * @param width canvas 宽度\r\n   * @param height canvas 高度\r\n   */\r\n\r\n\r\n  ViewController.prototype.changeSize = function (width, height) {\r\n    var graph = this.graph;\r\n\r\n    if (!isNumber(width) || !isNumber(height)) {\r\n      throw Error('invalid canvas width & height, please make sure width & height type is number');\r\n    }\r\n\r\n    graph.set({\r\n      width: width,\r\n      height: height\r\n    });\r\n    var canvas = graph.get('canvas');\r\n    canvas.changeSize(width, height); // change the size of grid plugin if it exists on graph\r\n\r\n    var plugins = graph.get('plugins');\r\n    plugins.forEach(function (plugin) {\r\n      if (plugin.get('gridContainer')) {\r\n        // 网格定位信息初始化\r\n        plugin.positionInit();\r\n      }\r\n    });\r\n  };\r\n\r\n  ViewController.prototype.destroy = function () {\r\n    this.graph = null;\r\n    this.destroyed = false;\r\n  };\r\n\r\n  return ViewController;\r\n}();\r\n\r\nexport default ViewController;"]},"metadata":{},"sourceType":"module"}